/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ut=Object.defineProperty;var Qi=Object.getOwnPropertyDescriptor;var Zi=Object.getOwnPropertyNames;var Ji=Object.prototype.hasOwnProperty;var er=(i,e,t)=>e in i?ut(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var tr=(i,e)=>{for(var t in e)ut(i,t,{get:e[t],enumerable:!0})},nr=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Zi(e))!Ji.call(i,r)&&r!==t&&ut(i,r,{get:()=>e[r],enumerable:!(n=Qi(e,r))||n.enumerable});return i};var ir=i=>nr(ut({},"__esModule",{value:!0}),i);var d=(i,e,t)=>er(i,typeof e!="symbol"?e+"":e,t);var po={};tr(po,{default:()=>jt});module.exports=ir(po);var Xt=require("obsidian");var xe=class i{constructor(e,t=document,n){d(this,"_stylesheet");d(this,"_plugin");d(this,"_root");d(this,"_subHandlers",[]);var o;let r=(o=t==null?void 0:t.win)!=null?o:t.ownerDocument.win;this._stylesheet=new r.globalThis.CSSStyleSheet,this._plugin=e,this._root=t,this.injectMain(),n&&this.copy(n)}get rulesLen(){return this._stylesheet.cssRules.length}injectMain(){this._root.adoptedStyleSheets=[this._stylesheet,...this._root.adoptedStyleSheets]}ejectMain(){let e=this._root.adoptedStyleSheets.filter(t=>t!=this._stylesheet);this._root.adoptedStyleSheets=e,this._subHandlers.forEach(t=>t.destroy()),this._subHandlers=[]}inject(e){e==this._root||this._subHandlers.find(t=>t._root==this._root)||this._subHandlers.push(new i(void 0,e,this._stylesheet))}eject(e){e!=this._root&&this._subHandlers.find((t,n)=>{if(t._root==e)return t.destroy(),this._subHandlers.splice(n,1),!0})}destroy(){this.ejectMain(),this._root=void 0,this._stylesheet=void 0,this._plugin&&(this._plugin.tagManager.colorsHandler=void 0)}insert(e,t=this.rulesLen){return this._subHandlers.forEach(n=>n.insert(e,t)),this._stylesheet.insertRule(e,t)}replace(e,t){this._stylesheet.deleteRule(t),this._stylesheet.insertRule(e,t),this._subHandlers.forEach(n=>n.replace(e,t))}moveSingleRule(e,t){if(t!==1&&t!==-1)throw Error("");if(e<=0&&t<0||e>=this.rulesLen-1&&t>0)return!1;let n=this._stylesheet.cssRules.item(e).cssText;this._stylesheet.deleteRule(e),this.insert(n,e+t),this._subHandlers.forEach(r=>r.moveSingleRule(e,t))}moveRule(e,t){if(e==t)return;t>e&&t--;let n=this._stylesheet.cssRules.item(e).cssText;this.removeSingle(e),this.insert(n,t),this._subHandlers.forEach(r=>r.moveRule(e,t))}removeSingle(e){this._stylesheet.deleteRule(e),this._subHandlers.forEach(t=>t.removeSingle(e))}remove(e,t){let n=this.rulesLen;for(let r=Math.min(t,n)-1;r>=e;r--)this._stylesheet.deleteRule(r);this._subHandlers.forEach(r=>r.remove(e,t))}removeAll(){this._stylesheet.replace(""),this._subHandlers.forEach(e=>e.removeAll())}copy(e){for(let t=0;t<e.cssRules.length;t++){let n=e.cssRules.item(t).cssText;this._stylesheet.insertRule(n,t)}}};var Un=["red","orange","yellow","green","cyan","blue","purple","pink"];function Wn(){var e;let i=[];for(let t=0;t<Un.length;t++){let n=Un[t],r=n[0].toUpperCase()+n.slice(1),o=(e=rr(n))!=null?e:"#ffffff";i.push({tag:n,name:r,color:o,showInMenu:!0})}return i}function Ee(i){let e=`.cm-custom-highlight-${i.tag}, .markdown-rendered mark.custom-highlight-${i.tag}, .ems-menu-item.ems-highlight-${i.tag}>.menu-item-title`,t="background-color",n=i.color;return`${e}{${t}:color(from ${n} srgb r g b/var(--hl-opacity));}`}function rr(i){var e;return(e=document.body.computedStyleMap().get(`--color-${i}`))==null?void 0:e.toString()}function qn(i){let e=new xe(i),t=i.settings.colorConfigs;for(let n=0;n<t.length;n++){let r=Ee(t[n]);e.insert(r)}return e}var Le={insertion:3,spoiler:3,superscript:3,subscript:3,customHighlight:3,customSpan:3,fencedDiv:3,tidyFormatting:!0,openTagMenuAfterFormat:!0,noStyledDivInSourceMode:!0,hlTagDisplayBehaviour:2,spanTagDisplayBehaviour:2,showHlTagInPreviewMode:!1,showSpanTagInPreviewMode:!1,alwaysShowFencedDivTag:0,colorButton:!0,showAccentColor:!0,showDefaultColor:!0,showRemoveColor:!0,lightModeHlOpacity:.4,darkModeHlOpacity:.5,get colorConfigs(){return Wn()},showDefaultSpanTag:!0,showRemoveSpanTag:!0,get predefinedSpanTag(){return[{name:"",tag:"",showInMenu:!0}]},showDefaultDivTag:!0,showRemoveDivTag:!0,get predefinedDivTag(){return[{name:"",tag:"",showInMenu:!0}]},editorEscape:!1,decoratePDF:!0};function jn(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function te(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?jn(Object(t),!0).forEach(function(n){or(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):jn(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function pt(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pt=function(e){return typeof e}:pt=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pt(i)}function or(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ue(){return ue=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},ue.apply(this,arguments)}function ar(i,e){if(i==null)return{};var t={},n=Object.keys(i),r,o;for(o=0;o<n.length;o++)r=n[o],!(e.indexOf(r)>=0)&&(t[r]=i[r]);return t}function sr(i,e){if(i==null)return{};var t=ar(i,e),n,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(i);for(r=0;r<o.length;r++)n=o[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(i,n)&&(t[n]=i[n])}return t}var lr="1.15.6";function le(i){if(typeof window!="undefined"&&window.navigator)return!!navigator.userAgent.match(i)}var ce=le(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),et=le(/Edge/i),Xn=le(/firefox/i),ze=le(/safari/i)&&!le(/chrome/i)&&!le(/android/i),ln=le(/iP(ad|od|hone)/i),ti=le(/chrome/i)&&le(/android/i),ni={capture:!1,passive:!1};function _(i,e,t){i.addEventListener(e,t,!ce&&ni)}function T(i,e,t){i.removeEventListener(e,t,!ce&&ni)}function St(i,e){if(e){if(e[0]===">"&&(e=e.substring(1)),i)try{if(i.matches)return i.matches(e);if(i.msMatchesSelector)return i.msMatchesSelector(e);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(e)}catch(t){return!1}return!1}}function ii(i){return i.host&&i!==document&&i.host.nodeType?i.host:i.parentNode}function Y(i,e,t,n){if(i){t=t||document;do{if(e!=null&&(e[0]===">"?i.parentNode===t&&St(i,e):St(i,e))||n&&i===t)return i;if(i===t)break}while(i=ii(i))}return null}var Yn=/\s+/g;function B(i,e,t){if(i&&e)if(i.classList)i.classList[t?"add":"remove"](e);else{var n=(" "+i.className+" ").replace(Yn," ").replace(" "+e+" "," ");i.className=(n+(t?" "+e:"")).replace(Yn," ")}}function g(i,e,t){var n=i&&i.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(i,""):i.currentStyle&&(t=i.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function Me(i,e){var t="";if(typeof i=="string")t=i;else do{var n=g(i,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(i=i.parentNode));var r=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return r&&new r(t)}function ri(i,e,t){if(i){var n=i.getElementsByTagName(e),r=0,o=n.length;if(t)for(;r<o;r++)t(n[r],r);return n}return[]}function ee(){var i=document.scrollingElement;return i||document.documentElement}function D(i,e,t,n,r){if(!(!i.getBoundingClientRect&&i!==window)){var o,a,s,l,u,c,h;if(i!==window&&i.parentNode&&i!==ee()?(o=i.getBoundingClientRect(),a=o.top,s=o.left,l=o.bottom,u=o.right,c=o.height,h=o.width):(a=0,s=0,l=window.innerHeight,u=window.innerWidth,c=window.innerHeight,h=window.innerWidth),(e||t)&&i!==window&&(r=r||i.parentNode,!ce))do if(r&&r.getBoundingClientRect&&(g(r,"transform")!=="none"||t&&g(r,"position")!=="static")){var p=r.getBoundingClientRect();a-=p.top+parseInt(g(r,"border-top-width")),s-=p.left+parseInt(g(r,"border-left-width")),l=a+o.height,u=s+o.width;break}while(r=r.parentNode);if(n&&i!==window){var m=Me(r||i),v=m&&m.a,E=m&&m.d;m&&(a/=E,s/=v,h/=v,c/=E,l=a+c,u=s+h)}return{top:a,left:s,bottom:l,right:u,width:h,height:c}}}function zn(i,e,t){for(var n=ge(i,!0),r=D(i)[e];n;){var o=D(n)[t],a=void 0;if(t==="top"||t==="left"?a=r>=o:a=r<=o,!a)return n;if(n===ee())break;n=ge(n,!1)}return!1}function Ae(i,e,t,n){for(var r=0,o=0,a=i.children;o<a.length;){if(a[o].style.display!=="none"&&a[o]!==b.ghost&&(n||a[o]!==b.dragged)&&Y(a[o],t.draggable,i,!1)){if(r===e)return a[o];r++}o++}return null}function un(i,e){for(var t=i.lastElementChild;t&&(t===b.ghost||g(t,"display")==="none"||e&&!St(t,e));)t=t.previousElementSibling;return t||null}function q(i,e){var t=0;if(!i||!i.parentNode)return-1;for(;i=i.previousElementSibling;)i.nodeName.toUpperCase()!=="TEMPLATE"&&i!==b.clone&&(!e||St(i,e))&&t++;return t}function $n(i){var e=0,t=0,n=ee();if(i)do{var r=Me(i),o=r.a,a=r.d;e+=i.scrollLeft*o,t+=i.scrollTop*a}while(i!==n&&(i=i.parentNode));return[e,t]}function ur(i,e){for(var t in i)if(i.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===i[t][n])return Number(t)}return-1}function ge(i,e){if(!i||!i.getBoundingClientRect)return ee();var t=i,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var r=g(t);if(t.clientWidth<t.scrollWidth&&(r.overflowX=="auto"||r.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(r.overflowY=="auto"||r.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return ee();if(n||e)return t;n=!0}}while(t=t.parentNode);return ee()}function cr(i,e){if(i&&e)for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}function Yt(i,e){return Math.round(i.top)===Math.round(e.top)&&Math.round(i.left)===Math.round(e.left)&&Math.round(i.height)===Math.round(e.height)&&Math.round(i.width)===Math.round(e.width)}var $e;function oi(i,e){return function(){if(!$e){var t=arguments,n=this;t.length===1?i.call(n,t[0]):i.apply(n,t),$e=setTimeout(function(){$e=void 0},e)}}}function dr(){clearTimeout($e),$e=void 0}function ai(i,e,t){i.scrollLeft+=e,i.scrollTop+=t}function si(i){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(i).cloneNode(!0):t?t(i).clone(!0)[0]:i.cloneNode(!0)}function li(i,e,t){var n={};return Array.from(i.children).forEach(function(r){var o,a,s,l;if(!(!Y(r,e.draggable,i,!1)||r.animated||r===t)){var u=D(r);n.left=Math.min((o=n.left)!==null&&o!==void 0?o:1/0,u.left),n.top=Math.min((a=n.top)!==null&&a!==void 0?a:1/0,u.top),n.right=Math.max((s=n.right)!==null&&s!==void 0?s:-1/0,u.right),n.bottom=Math.max((l=n.bottom)!==null&&l!==void 0?l:-1/0,u.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var A="Sortable"+new Date().getTime();function hr(){var i=[],e;return{captureAnimationState:function(){if(i=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(r){if(!(g(r,"display")==="none"||r===b.ghost)){i.push({target:r,rect:D(r)});var o=te({},i[i.length-1].rect);if(r.thisAnimationDuration){var a=Me(r,!0);a&&(o.top-=a.f,o.left-=a.e)}r.fromRect=o}})}},addAnimationState:function(n){i.push(n)},removeAnimationState:function(n){i.splice(ur(i,{target:n}),1)},animateAll:function(n){var r=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var o=!1,a=0;i.forEach(function(s){var l=0,u=s.target,c=u.fromRect,h=D(u),p=u.prevFromRect,m=u.prevToRect,v=s.rect,E=Me(u,!0);E&&(h.top-=E.f,h.left-=E.e),u.toRect=h,u.thisAnimationDuration&&Yt(p,h)&&!Yt(c,h)&&(v.top-h.top)/(v.left-h.left)===(c.top-h.top)/(c.left-h.left)&&(l=pr(v,p,m,r.options)),Yt(h,c)||(u.prevFromRect=c,u.prevToRect=h,l||(l=r.options.animation),r.animate(u,v,h,l)),l&&(o=!0,a=Math.max(a,l),clearTimeout(u.animationResetTimer),u.animationResetTimer=setTimeout(function(){u.animationTime=0,u.prevFromRect=null,u.fromRect=null,u.prevToRect=null,u.thisAnimationDuration=null},l),u.thisAnimationDuration=l)}),clearTimeout(e),o?e=setTimeout(function(){typeof n=="function"&&n()},a):typeof n=="function"&&n(),i=[]},animate:function(n,r,o,a){if(a){g(n,"transition",""),g(n,"transform","");var s=Me(this.el),l=s&&s.a,u=s&&s.d,c=(r.left-o.left)/(l||1),h=(r.top-o.top)/(u||1);n.animatingX=!!c,n.animatingY=!!h,g(n,"transform","translate3d("+c+"px,"+h+"px,0)"),this.forRepaintDummy=fr(n),g(n,"transition","transform "+a+"ms"+(this.options.easing?" "+this.options.easing:"")),g(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){g(n,"transition",""),g(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},a)}}}}function fr(i){return i.offsetWidth}function pr(i,e,t,n){return Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var Re=[],zt={initializeByDefault:!0},tt={mount:function(e){for(var t in zt)zt.hasOwnProperty(t)&&!(t in e)&&(e[t]=zt[t]);Re.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),Re.push(e)},pluginEvent:function(e,t,n){var r=this;this.eventCanceled=!1,n.cancel=function(){r.eventCanceled=!0};var o=e+"Global";Re.forEach(function(a){t[a.pluginName]&&(t[a.pluginName][o]&&t[a.pluginName][o](te({sortable:t},n)),t.options[a.pluginName]&&t[a.pluginName][e]&&t[a.pluginName][e](te({sortable:t},n)))})},initializePlugins:function(e,t,n,r){Re.forEach(function(s){var l=s.pluginName;if(!(!e.options[l]&&!s.initializeByDefault)){var u=new s(e,t,e.options);u.sortable=e,u.options=e.options,e[l]=u,ue(n,u.defaults)}});for(var o in e.options)if(e.options.hasOwnProperty(o)){var a=this.modifyOption(e,o,e.options[o]);typeof a!="undefined"&&(e.options[o]=a)}},getEventProperties:function(e,t){var n={};return Re.forEach(function(r){typeof r.eventProperties=="function"&&ue(n,r.eventProperties.call(t[r.pluginName],e))}),n},modifyOption:function(e,t,n){var r;return Re.forEach(function(o){e[o.pluginName]&&o.optionListeners&&typeof o.optionListeners[t]=="function"&&(r=o.optionListeners[t].call(e[o.pluginName],n))}),r}};function mr(i){var e=i.sortable,t=i.rootEl,n=i.name,r=i.targetEl,o=i.cloneEl,a=i.toEl,s=i.fromEl,l=i.oldIndex,u=i.newIndex,c=i.oldDraggableIndex,h=i.newDraggableIndex,p=i.originalEvent,m=i.putSortable,v=i.extraEventProperties;if(e=e||t&&t[A],!!e){var E,O=e.options,H="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!ce&&!et?E=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(E=document.createEvent("Event"),E.initEvent(n,!0,!0)),E.to=a||t,E.from=s||t,E.item=r||t,E.clone=o,E.oldIndex=l,E.newIndex=u,E.oldDraggableIndex=c,E.newDraggableIndex=h,E.originalEvent=p,E.pullMode=m?m.lastPutMode:void 0;var x=te(te({},v),tt.getEventProperties(n,e));for(var j in x)E[j]=x[j];t&&t.dispatchEvent(E),O[H]&&O[H].call(e,E)}}var gr=["evt"],M=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=n.evt,o=sr(n,gr);tt.pluginEvent.bind(b)(e,t,te({dragEl:f,parentEl:w,ghostEl:S,rootEl:y,nextEl:ye,lastDownEl:mt,cloneEl:I,cloneHidden:me,dragStarted:je,putSortable:L,activeSortable:b.active,originalEvent:r,oldIndex:Ne,oldDraggableIndex:Qe,newIndex:V,newDraggableIndex:pe,hideGhostForTarget:hi,unhideGhostForTarget:fi,cloneNowHidden:function(){me=!0},cloneNowShown:function(){me=!1},dispatchSortableEvent:function(s){P({sortable:t,name:s,originalEvent:r})}},o))};function P(i){mr(te({putSortable:L,cloneEl:I,targetEl:f,rootEl:y,oldIndex:Ne,oldDraggableIndex:Qe,newIndex:V,newDraggableIndex:pe},i))}var f,w,S,y,ye,mt,I,me,Ne,V,Qe,pe,ct,L,Pe=!1,Tt=!1,Et=[],_e,X,$t,Qt,Qn,Zn,je,Oe,Ze,Je=!1,dt=!1,gt,R,Zt=[],rn=!1,_t=[],yt=typeof document!="undefined",ht=ln,Jn=et||ce?"cssFloat":"float",br=yt&&!ti&&!ln&&"draggable"in document.createElement("div"),ui=function(){if(yt){if(ce)return!1;var i=document.createElement("x");return i.style.cssText="pointer-events:auto",i.style.pointerEvents==="auto"}}(),ci=function(e,t){var n=g(e),r=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),o=Ae(e,0,t),a=Ae(e,1,t),s=o&&g(o),l=a&&g(a),u=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+D(o).width,c=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+D(a).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&s.float&&s.float!=="none"){var h=s.float==="left"?"left":"right";return a&&(l.clear==="both"||l.clear===h)?"vertical":"horizontal"}return o&&(s.display==="block"||s.display==="flex"||s.display==="table"||s.display==="grid"||u>=r&&n[Jn]==="none"||a&&n[Jn]==="none"&&u+c>r)?"vertical":"horizontal"},vr=function(e,t,n){var r=n?e.left:e.top,o=n?e.right:e.bottom,a=n?e.width:e.height,s=n?t.left:t.top,l=n?t.right:t.bottom,u=n?t.width:t.height;return r===s||o===l||r+a/2===s+u/2},Sr=function(e,t){var n;return Et.some(function(r){var o=r[A].options.emptyInsertThreshold;if(!(!o||un(r))){var a=D(r),s=e>=a.left-o&&e<=a.right+o,l=t>=a.top-o&&t<=a.bottom+o;if(s&&l)return n=r}}),n},di=function(e){function t(o,a){return function(s,l,u,c){var h=s.options.group.name&&l.options.group.name&&s.options.group.name===l.options.group.name;if(o==null&&(a||h))return!0;if(o==null||o===!1)return!1;if(a&&o==="clone")return o;if(typeof o=="function")return t(o(s,l,u,c),a)(s,l,u,c);var p=(a?s:l).options.group.name;return o===!0||typeof o=="string"&&o===p||o.join&&o.indexOf(p)>-1}}var n={},r=e.group;(!r||pt(r)!="object")&&(r={name:r}),n.name=r.name,n.checkPull=t(r.pull,!0),n.checkPut=t(r.put),n.revertClone=r.revertClone,e.group=n},hi=function(){!ui&&S&&g(S,"display","none")},fi=function(){!ui&&S&&g(S,"display","")};yt&&!ti&&document.addEventListener("click",function(i){if(Tt)return i.preventDefault(),i.stopPropagation&&i.stopPropagation(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),Tt=!1,!1},!0);var Ce=function(e){if(f){e=e.touches?e.touches[0]:e;var t=Sr(e.clientX,e.clientY);if(t){var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[A]._onDragOver(n)}}},Tr=function(e){f&&f.parentNode[A]._isOutsideThisEl(e.target)};function b(i,e){if(!(i&&i.nodeType&&i.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=e=ue({},e),i[A]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(i.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return ci(i,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(a,s){a.setData("Text",s.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:b.supportPointer!==!1&&"PointerEvent"in window&&(!ze||ln),emptyInsertThreshold:5};tt.initializePlugins(this,i,t);for(var n in t)!(n in e)&&(e[n]=t[n]);di(e);for(var r in this)r.charAt(0)==="_"&&typeof this[r]=="function"&&(this[r]=this[r].bind(this));this.nativeDraggable=e.forceFallback?!1:br,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?_(i,"pointerdown",this._onTapStart):(_(i,"mousedown",this._onTapStart),_(i,"touchstart",this._onTapStart)),this.nativeDraggable&&(_(i,"dragover",this),_(i,"dragenter",this)),Et.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),ue(this,hr())}b.prototype={constructor:b,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(Oe=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,f):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,r=this.options,o=r.preventOnFilter,a=e.type,s=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(s||e).target,u=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,c=r.filter;if(Dr(n),!f&&!(/mousedown|pointerdown/.test(a)&&e.button!==0||r.disabled)&&!u.isContentEditable&&!(!this.nativeDraggable&&ze&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Y(l,r.draggable,n,!1),!(l&&l.animated)&&mt!==l)){if(Ne=q(l),Qe=q(l,r.draggable),typeof c=="function"){if(c.call(this,e,l,this)){P({sortable:t,rootEl:u,name:"filter",targetEl:l,toEl:n,fromEl:n}),M("filter",t,{evt:e}),o&&e.preventDefault();return}}else if(c&&(c=c.split(",").some(function(h){if(h=Y(u,h.trim(),n,!1),h)return P({sortable:t,rootEl:h,name:"filter",targetEl:l,fromEl:n,toEl:n}),M("filter",t,{evt:e}),!0}),c)){o&&e.preventDefault();return}r.handle&&!Y(u,r.handle,n,!1)||this._prepareDragStart(e,s,l)}}},_prepareDragStart:function(e,t,n){var r=this,o=r.el,a=r.options,s=o.ownerDocument,l;if(n&&!f&&n.parentNode===o){var u=D(n);if(y=o,f=n,w=f.parentNode,ye=f.nextSibling,mt=n,ct=a.group,b.dragged=f,_e={target:f,clientX:(t||e).clientX,clientY:(t||e).clientY},Qn=_e.clientX-u.left,Zn=_e.clientY-u.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,f.style["will-change"]="all",l=function(){if(M("delayEnded",r,{evt:e}),b.eventCanceled){r._onDrop();return}r._disableDelayedDragEvents(),!Xn&&r.nativeDraggable&&(f.draggable=!0),r._triggerDragStart(e,t),P({sortable:r,name:"choose",originalEvent:e}),B(f,a.chosenClass,!0)},a.ignore.split(",").forEach(function(c){ri(f,c.trim(),Jt)}),_(s,"dragover",Ce),_(s,"mousemove",Ce),_(s,"touchmove",Ce),a.supportPointer?(_(s,"pointerup",r._onDrop),!this.nativeDraggable&&_(s,"pointercancel",r._onDrop)):(_(s,"mouseup",r._onDrop),_(s,"touchend",r._onDrop),_(s,"touchcancel",r._onDrop)),Xn&&this.nativeDraggable&&(this.options.touchStartThreshold=4,f.draggable=!0),M("delayStart",this,{evt:e}),a.delay&&(!a.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(et||ce))){if(b.eventCanceled){this._onDrop();return}a.supportPointer?(_(s,"pointerup",r._disableDelayedDrag),_(s,"pointercancel",r._disableDelayedDrag)):(_(s,"mouseup",r._disableDelayedDrag),_(s,"touchend",r._disableDelayedDrag),_(s,"touchcancel",r._disableDelayedDrag)),_(s,"mousemove",r._delayedDragTouchMoveHandler),_(s,"touchmove",r._delayedDragTouchMoveHandler),a.supportPointer&&_(s,"pointermove",r._delayedDragTouchMoveHandler),r._dragStartTimer=setTimeout(l,a.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){f&&Jt(f),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;T(e,"mouseup",this._disableDelayedDrag),T(e,"touchend",this._disableDelayedDrag),T(e,"touchcancel",this._disableDelayedDrag),T(e,"pointerup",this._disableDelayedDrag),T(e,"pointercancel",this._disableDelayedDrag),T(e,"mousemove",this._delayedDragTouchMoveHandler),T(e,"touchmove",this._delayedDragTouchMoveHandler),T(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?_(document,"pointermove",this._onTouchMove):t?_(document,"touchmove",this._onTouchMove):_(document,"mousemove",this._onTouchMove):(_(f,"dragend",this),_(y,"dragstart",this._onDragStart));try{document.selection?bt(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(n){}},_dragStarted:function(e,t){if(Pe=!1,y&&f){M("dragStarted",this,{evt:t}),this.nativeDraggable&&_(document,"dragover",Tr);var n=this.options;!e&&B(f,n.dragClass,!1),B(f,n.ghostClass,!0),b.active=this,e&&this._appendGhost(),P({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(X){this._lastX=X.clientX,this._lastY=X.clientY,hi();for(var e=document.elementFromPoint(X.clientX,X.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(X.clientX,X.clientY),e!==t);)t=e;if(f.parentNode[A]._isOutsideThisEl(e),t)do{if(t[A]){var n=void 0;if(n=t[A]._onDragOver({clientX:X.clientX,clientY:X.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=ii(t));fi()}},_onTouchMove:function(e){if(_e){var t=this.options,n=t.fallbackTolerance,r=t.fallbackOffset,o=e.touches?e.touches[0]:e,a=S&&Me(S,!0),s=S&&a&&a.a,l=S&&a&&a.d,u=ht&&R&&$n(R),c=(o.clientX-_e.clientX+r.x)/(s||1)+(u?u[0]-Zt[0]:0)/(s||1),h=(o.clientY-_e.clientY+r.y)/(l||1)+(u?u[1]-Zt[1]:0)/(l||1);if(!b.active&&!Pe){if(n&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(S){a?(a.e+=c-($t||0),a.f+=h-(Qt||0)):a={a:1,b:0,c:0,d:1,e:c,f:h};var p="matrix(".concat(a.a,",").concat(a.b,",").concat(a.c,",").concat(a.d,",").concat(a.e,",").concat(a.f,")");g(S,"webkitTransform",p),g(S,"mozTransform",p),g(S,"msTransform",p),g(S,"transform",p),$t=c,Qt=h,X=o}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!S){var e=this.options.fallbackOnBody?document.body:y,t=D(f,!0,ht,!0,e),n=this.options;if(ht){for(R=e;g(R,"position")==="static"&&g(R,"transform")==="none"&&R!==document;)R=R.parentNode;R!==document.body&&R!==document.documentElement?(R===document&&(R=ee()),t.top+=R.scrollTop,t.left+=R.scrollLeft):R=ee(),Zt=$n(R)}S=f.cloneNode(!0),B(S,n.ghostClass,!1),B(S,n.fallbackClass,!0),B(S,n.dragClass,!0),g(S,"transition",""),g(S,"transform",""),g(S,"box-sizing","border-box"),g(S,"margin",0),g(S,"top",t.top),g(S,"left",t.left),g(S,"width",t.width),g(S,"height",t.height),g(S,"opacity","0.8"),g(S,"position",ht?"absolute":"fixed"),g(S,"zIndex","100000"),g(S,"pointerEvents","none"),b.ghost=S,e.appendChild(S),g(S,"transform-origin",Qn/parseInt(S.style.width)*100+"% "+Zn/parseInt(S.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,r=e.dataTransfer,o=n.options;if(M("dragStart",this,{evt:e}),b.eventCanceled){this._onDrop();return}M("setupClone",this),b.eventCanceled||(I=si(f),I.removeAttribute("id"),I.draggable=!1,I.style["will-change"]="",this._hideClone(),B(I,this.options.chosenClass,!1),b.clone=I),n.cloneId=bt(function(){M("clone",n),!b.eventCanceled&&(n.options.removeCloneOnHide||y.insertBefore(I,f),n._hideClone(),P({sortable:n,name:"clone"}))}),!t&&B(f,o.dragClass,!0),t?(Tt=!0,n._loopId=setInterval(n._emulateDragOver,50)):(T(document,"mouseup",n._onDrop),T(document,"touchend",n._onDrop),T(document,"touchcancel",n._onDrop),r&&(r.effectAllowed="move",o.setData&&o.setData.call(n,r,f)),_(document,"drop",n),g(f,"transform","translateZ(0)")),Pe=!0,n._dragStartId=bt(n._dragStarted.bind(n,t,e)),_(document,"selectstart",n),je=!0,window.getSelection().removeAllRanges(),ze&&g(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,r,o,a,s=this.options,l=s.group,u=b.active,c=ct===l,h=s.sort,p=L||u,m,v=this,E=!1;if(rn)return;function O(qe,zi){M(qe,v,te({evt:e,isOwner:c,axis:m?"vertical":"horizontal",revert:a,dragRect:r,targetRect:o,canSort:h,fromSortable:p,target:n,completed:x,onMove:function(Vn,$i){return ft(y,t,f,r,Vn,D(Vn),e,$i)},changed:j},zi))}function H(){O("dragOverAnimationCapture"),v.captureAnimationState(),v!==p&&p.captureAnimationState()}function x(qe){return O("dragOverCompleted",{insertion:qe}),qe&&(c?u._hideClone():u._showClone(v),v!==p&&(B(f,L?L.options.ghostClass:u.options.ghostClass,!1),B(f,s.ghostClass,!0)),L!==v&&v!==b.active?L=v:v===b.active&&L&&(L=null),p===v&&(v._ignoreWhileAnimating=n),v.animateAll(function(){O("dragOverAnimationComplete"),v._ignoreWhileAnimating=null}),v!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(n===f&&!f.animated||n===t&&!n.animated)&&(Oe=null),!s.dragoverBubble&&!e.rootEl&&n!==document&&(f.parentNode[A]._isOutsideThisEl(e.target),!qe&&Ce(e)),!s.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),E=!0}function j(){V=q(f),pe=q(f,s.draggable),P({sortable:v,name:"change",toEl:t,newIndex:V,newDraggableIndex:pe,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=Y(n,s.draggable,t,!0),O("dragOver"),b.eventCanceled)return E;if(f.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||v._ignoreWhileAnimating===n)return x(!1);if(Tt=!1,u&&!s.disabled&&(c?h||(a=w!==y):L===this||(this.lastPutMode=ct.checkPull(this,u,f,e))&&l.checkPut(this,u,f,e))){if(m=this._getDirection(e,n)==="vertical",r=D(f),O("dragOverValid"),b.eventCanceled)return E;if(a)return w=y,H(),this._hideClone(),O("revert"),b.eventCanceled||(ye?y.insertBefore(f,ye):y.appendChild(f)),x(!0);var F=un(t,s.draggable);if(!F||yr(e,m,this)&&!F.animated){if(F===f)return x(!1);if(F&&t===e.target&&(n=F),n&&(o=D(n)),ft(y,t,f,r,n,o,e,!!n)!==!1)return H(),F&&F.nextSibling?t.insertBefore(f,F.nextSibling):t.appendChild(f),w=t,j(),x(!0)}else if(F&&Cr(e,m,this)){var ve=Ae(t,0,s,!0);if(ve===f)return x(!1);if(n=ve,o=D(n),ft(y,t,f,r,n,o,e,!1)!==!1)return H(),t.insertBefore(f,ve),w=t,j(),x(!0)}else if(n.parentNode===t){o=D(n);var J=0,Se,Be=f.parentNode!==t,G=!vr(f.animated&&f.toRect||r,n.animated&&n.toRect||o,m),Ve=m?"top":"left",he=zn(n,"top","top")||zn(f,"top","top"),Ue=he?he.scrollTop:void 0;Oe!==n&&(Se=o[Ve],Je=!1,dt=!G&&s.invertSwap||Be),J=Ir(e,n,o,m,G?1:s.swapThreshold,s.invertedSwapThreshold==null?s.swapThreshold:s.invertedSwapThreshold,dt,Oe===n);var se;if(J!==0){var Te=q(f);do Te-=J,se=w.children[Te];while(se&&(g(se,"display")==="none"||se===S))}if(J===0||se===n)return x(!1);Oe=n,Ze=J;var We=n.nextElementSibling,fe=!1;fe=J===1;var lt=ft(y,t,f,r,n,o,e,fe);if(lt!==!1)return(lt===1||lt===-1)&&(fe=lt===1),rn=!0,setTimeout(_r,30),H(),fe&&!We?t.appendChild(f):n.parentNode.insertBefore(f,fe?We:n),he&&ai(he,0,Ue-he.scrollTop),w=f.parentNode,Se!==void 0&&!dt&&(gt=Math.abs(Se-D(n)[Ve])),j(),x(!0)}if(t.contains(f))return x(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){T(document,"mousemove",this._onTouchMove),T(document,"touchmove",this._onTouchMove),T(document,"pointermove",this._onTouchMove),T(document,"dragover",Ce),T(document,"mousemove",Ce),T(document,"touchmove",Ce)},_offUpEvents:function(){var e=this.el.ownerDocument;T(e,"mouseup",this._onDrop),T(e,"touchend",this._onDrop),T(e,"pointerup",this._onDrop),T(e,"pointercancel",this._onDrop),T(e,"touchcancel",this._onDrop),T(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(V=q(f),pe=q(f,n.draggable),M("drop",this,{evt:e}),w=f&&f.parentNode,V=q(f),pe=q(f,n.draggable),b.eventCanceled){this._nulling();return}Pe=!1,dt=!1,Je=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),on(this.cloneId),on(this._dragStartId),this.nativeDraggable&&(T(document,"drop",this),T(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),ze&&g(document.body,"user-select",""),g(f,"transform",""),e&&(je&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),S&&S.parentNode&&S.parentNode.removeChild(S),(y===w||L&&L.lastPutMode!=="clone")&&I&&I.parentNode&&I.parentNode.removeChild(I),f&&(this.nativeDraggable&&T(f,"dragend",this),Jt(f),f.style["will-change"]="",je&&!Pe&&B(f,L?L.options.ghostClass:this.options.ghostClass,!1),B(f,this.options.chosenClass,!1),P({sortable:this,name:"unchoose",toEl:w,newIndex:null,newDraggableIndex:null,originalEvent:e}),y!==w?(V>=0&&(P({rootEl:w,name:"add",toEl:w,fromEl:y,originalEvent:e}),P({sortable:this,name:"remove",toEl:w,originalEvent:e}),P({rootEl:w,name:"sort",toEl:w,fromEl:y,originalEvent:e}),P({sortable:this,name:"sort",toEl:w,originalEvent:e})),L&&L.save()):V!==Ne&&V>=0&&(P({sortable:this,name:"update",toEl:w,originalEvent:e}),P({sortable:this,name:"sort",toEl:w,originalEvent:e})),b.active&&((V==null||V===-1)&&(V=Ne,pe=Qe),P({sortable:this,name:"end",toEl:w,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){M("nulling",this),y=f=w=S=ye=I=mt=me=_e=X=je=V=pe=Ne=Qe=Oe=Ze=L=ct=b.dragged=b.ghost=b.clone=b.active=null,_t.forEach(function(e){e.checked=!0}),_t.length=$t=Qt=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":f&&(this._onDragOver(e),Er(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,r=0,o=n.length,a=this.options;r<o;r++)t=n[r],Y(t,a.draggable,this.el,!1)&&e.push(t.getAttribute(a.dataIdAttr)||kr(t));return e},sort:function(e,t){var n={},r=this.el;this.toArray().forEach(function(o,a){var s=r.children[a];Y(s,this.options.draggable,r,!1)&&(n[o]=s)},this),t&&this.captureAnimationState(),e.forEach(function(o){n[o]&&(r.removeChild(n[o]),r.appendChild(n[o]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return Y(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var r=tt.modifyOption(this,e,t);typeof r!="undefined"?n[e]=r:n[e]=t,e==="group"&&di(n)},destroy:function(){M("destroy",this);var e=this.el;e[A]=null,T(e,"mousedown",this._onTapStart),T(e,"touchstart",this._onTapStart),T(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(T(e,"dragover",this),T(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Et.splice(Et.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!me){if(M("hideClone",this),b.eventCanceled)return;g(I,"display","none"),this.options.removeCloneOnHide&&I.parentNode&&I.parentNode.removeChild(I),me=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(me){if(M("showClone",this),b.eventCanceled)return;f.parentNode==y&&!this.options.group.revertClone?y.insertBefore(I,f):ye?y.insertBefore(I,ye):y.appendChild(I),this.options.group.revertClone&&this.animate(f,I),g(I,"display",""),me=!1}}};function Er(i){i.dataTransfer&&(i.dataTransfer.dropEffect="move"),i.cancelable&&i.preventDefault()}function ft(i,e,t,n,r,o,a,s){var l,u=i[A],c=u.options.onMove,h;return window.CustomEvent&&!ce&&!et?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=i,l.dragged=t,l.draggedRect=n,l.related=r||e,l.relatedRect=o||D(e),l.willInsertAfter=s,l.originalEvent=a,i.dispatchEvent(l),c&&(h=c.call(u,l,a)),h}function Jt(i){i.draggable=!1}function _r(){rn=!1}function Cr(i,e,t){var n=D(Ae(t.el,0,t.options,!0)),r=li(t.el,t.options,S),o=10;return e?i.clientX<r.left-o||i.clientY<n.top&&i.clientX<n.right:i.clientY<r.top-o||i.clientY<n.bottom&&i.clientX<n.left}function yr(i,e,t){var n=D(un(t.el,t.options.draggable)),r=li(t.el,t.options,S),o=10;return e?i.clientX>r.right+o||i.clientY>n.bottom&&i.clientX>n.left:i.clientY>r.bottom+o||i.clientX>n.right&&i.clientY>n.top}function Ir(i,e,t,n,r,o,a,s){var l=n?i.clientY:i.clientX,u=n?t.height:t.width,c=n?t.top:t.left,h=n?t.bottom:t.right,p=!1;if(!a){if(s&&gt<u*r){if(!Je&&(Ze===1?l>c+u*o/2:l<h-u*o/2)&&(Je=!0),Je)p=!0;else if(Ze===1?l<c+gt:l>h-gt)return-Ze}else if(l>c+u*(1-r)/2&&l<h-u*(1-r)/2)return wr(e)}return p=p||a,p&&(l<c+u*o/2||l>h-u*o/2)?l>c+u/2?1:-1:0}function wr(i){return q(f)<q(i)?1:-1}function kr(i){for(var e=i.tagName+i.className+i.src+i.href+i.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function Dr(i){_t.length=0;for(var e=i.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&_t.push(n)}}function bt(i){return setTimeout(i,0)}function on(i){return clearTimeout(i)}yt&&_(document,"touchmove",function(i){(b.active||Pe)&&i.cancelable&&i.preventDefault()});b.utils={on:_,off:T,css:g,find:ri,is:function(e,t){return!!Y(e,t,e,!1)},extend:cr,throttle:oi,closest:Y,toggleClass:B,clone:si,index:q,nextTick:bt,cancelNextTick:on,detectDirection:ci,getChild:Ae,expando:A};b.get=function(i){return i[A]};b.mount=function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(b.utils=te(te({},b.utils),n.utils)),tt.mount(n)})};b.create=function(i,e){return new b(i,e)};b.version=lr;var k=[],Xe,an,sn=!1,en,tn,Ct,Ye;function xr(){function i(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return i.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?_(document,"dragover",this._handleAutoScroll):this.options.supportPointer?_(document,"pointermove",this._handleFallbackAutoScroll):n.touches?_(document,"touchmove",this._handleFallbackAutoScroll):_(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?T(document,"dragover",this._handleAutoScroll):(T(document,"pointermove",this._handleFallbackAutoScroll),T(document,"touchmove",this._handleFallbackAutoScroll),T(document,"mousemove",this._handleFallbackAutoScroll)),ei(),vt(),dr()},nulling:function(){Ct=an=Xe=sn=Ye=en=tn=null,k.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var r=this,o=(t.touches?t.touches[0]:t).clientX,a=(t.touches?t.touches[0]:t).clientY,s=document.elementFromPoint(o,a);if(Ct=t,n||this.options.forceAutoScrollFallback||et||ce||ze){nn(t,this.options,s,n);var l=ge(s,!0);sn&&(!Ye||o!==en||a!==tn)&&(Ye&&ei(),Ye=setInterval(function(){var u=ge(document.elementFromPoint(o,a),!0);u!==l&&(l=u,vt()),nn(t,r.options,u,n)},10),en=o,tn=a)}else{if(!this.options.bubbleScroll||ge(s,!0)===ee()){vt();return}nn(t,this.options,ge(s,!1),!1)}}},ue(i,{pluginName:"scroll",initializeByDefault:!0})}function vt(){k.forEach(function(i){clearInterval(i.pid)}),k=[]}function ei(){clearInterval(Ye)}var nn=oi(function(i,e,t,n){if(e.scroll){var r=(i.touches?i.touches[0]:i).clientX,o=(i.touches?i.touches[0]:i).clientY,a=e.scrollSensitivity,s=e.scrollSpeed,l=ee(),u=!1,c;an!==t&&(an=t,vt(),Xe=e.scroll,c=e.scrollFn,Xe===!0&&(Xe=ge(t,!0)));var h=0,p=Xe;do{var m=p,v=D(m),E=v.top,O=v.bottom,H=v.left,x=v.right,j=v.width,F=v.height,ve=void 0,J=void 0,Se=m.scrollWidth,Be=m.scrollHeight,G=g(m),Ve=m.scrollLeft,he=m.scrollTop;m===l?(ve=j<Se&&(G.overflowX==="auto"||G.overflowX==="scroll"||G.overflowX==="visible"),J=F<Be&&(G.overflowY==="auto"||G.overflowY==="scroll"||G.overflowY==="visible")):(ve=j<Se&&(G.overflowX==="auto"||G.overflowX==="scroll"),J=F<Be&&(G.overflowY==="auto"||G.overflowY==="scroll"));var Ue=ve&&(Math.abs(x-r)<=a&&Ve+j<Se)-(Math.abs(H-r)<=a&&!!Ve),se=J&&(Math.abs(O-o)<=a&&he+F<Be)-(Math.abs(E-o)<=a&&!!he);if(!k[h])for(var Te=0;Te<=h;Te++)k[Te]||(k[Te]={});(k[h].vx!=Ue||k[h].vy!=se||k[h].el!==m)&&(k[h].el=m,k[h].vx=Ue,k[h].vy=se,clearInterval(k[h].pid),(Ue!=0||se!=0)&&(u=!0,k[h].pid=setInterval(function(){n&&this.layer===0&&b.active._onTouchMove(Ct);var We=k[this.layer].vy?k[this.layer].vy*s:0,fe=k[this.layer].vx?k[this.layer].vx*s:0;typeof c=="function"&&c.call(b.dragged.parentNode[A],fe,We,i,Ct,k[this.layer].el)!=="continue"||ai(k[this.layer].el,fe,We)}.bind({layer:h}),24))),h++}while(e.bubbleScroll&&p!==l&&(p=ge(p,!1)));sn=u}},30),pi=function(e){var t=e.originalEvent,n=e.putSortable,r=e.dragEl,o=e.activeSortable,a=e.dispatchSortableEvent,s=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(t){var u=n||o;s();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,h=document.elementFromPoint(c.clientX,c.clientY);l(),u&&!u.el.contains(h)&&(a("spill"),this.onSpill({dragEl:r,putSortable:n}))}};function cn(){}cn.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var r=Ae(this.sortable.el,this.startIndex,this.options);r?this.sortable.el.insertBefore(t,r):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:pi};ue(cn,{pluginName:"revertOnSpill"});function dn(){}dn.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,r=n||this.sortable;r.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),r.animateAll()},drop:pi};ue(dn,{pluginName:"removeOnSpill"});b.mount(new xr);b.mount(dn,cn);var mi=b;var we=require("obsidian");var gi={0:"Always visible",1:"When touching the tag itself",2:"When touching its syntax"},Or={0:"Default",2:"Editor only",1:"Preview only",3:"Both editor and preview"},Ie={0:"Disable all",2:"Editor only",1:"Preview only",3:"Enable all"},bi={type:5,addBtnPlaceholder:"Add color",nameFieldPlaceholder:"Color name",tagFieldPlaceholder:"Tag string",tagFilter:/[^a-z0-9-]/gi,onAdd:(i,e,t)=>{e.addColorPicker(n=>{let r=i.plugin,o=r.settings.colorConfigs,a=r.tagManager;n.setValue(t.color),n.colorPickerEl.addClasses(["ems-field","ems-field-color-picker"]),n.onChange(s=>{t.color=s;let l=Ee(t),u=o.findIndex(c=>c==t);a.colorsHandler.replace(l,u),i.saveSettings()})})},onTagChange:(i,e,t)=>{let n=Ee(e);i.plugin.tagManager.colorsHandler.replace(n,t)}},vi={type:6,addBtnPlaceholder:"Add tag",nameFieldPlaceholder:"Tag name",tagFieldPlaceholder:"Tag string",tagFilter:/[^ a-z0-9-]/gi},Si={type:7,addBtnPlaceholder:"Add tag",nameFieldPlaceholder:"Tag name",tagFieldPlaceholder:"Tag string",tagFilter:/[^ a-z0-9-]/gi},Ti=i=>[{id:"syntax-switch",heading:"Syntax switch",collapsible:!0,items:[{name:"Insertion (underline)",desc:'Use double plus ("++") as a delimiter.',fields:[{type:2,record:i,key:"insertion",spec:{options:Ie},update:{internal:!0,deep:!0},callback:(e,t)=>t.reconfigureDelimLookup()}]},{name:"Discord-flavored spoiler",desc:'Use double bars ("||") as a delimiter.',fields:[{type:2,record:i,key:"spoiler",spec:{options:Ie},update:{internal:!0,deep:!0},callback:(e,t)=>t.reconfigureDelimLookup()}]},{name:"Pandoc-style superscript",desc:'Use a single caret ("^") as a delimiter.',fields:[{type:2,record:i,key:"superscript",spec:{options:Ie},update:{internal:!0,deep:!0},callback:(e,t)=>t.reconfigureDelimLookup()}]},{name:"Pandoc-style subscript",desc:'Use a single tilde ("~") as a delimiter.',fields:[{type:2,record:i,key:"subscript",spec:{options:Ie},update:{internal:!0,deep:!0},callback:(e,t)=>t.reconfigureDelimLookup()}]},{name:"Highlight color tag",desc:'Use alphanumeric and hyphen characters ("A-Za-z0-9-") after the opening delimiter covered by curly brackets ("{}").',fields:[{type:2,record:i,key:"customHighlight",spec:{options:Ie},update:{internal:!0,deep:!0},callback:(e,t)=>t.reconfigureDelimLookup()}]},{name:"Custom span",desc:'Use double exclamation marks ("!!") as a delimiter. Can be inserted after the opening delimiter by a tag with the same way as highlight tag. Additionally, you can use multiple classes inside it, separated by space(s).',fields:[{type:2,record:i,key:"customSpan",spec:{options:Ie},update:{internal:!0,deep:!0},callback:(e,t)=>t.reconfigureDelimLookup()}]},{name:"Pandoc-style fenced div (custom block)",desc:'Use three colons (":::") or more at the beginning of a paragraph, followed by alphanumeric and hyphen character ("A-Za-z0-9") after them. Use space to separate each class.',fields:[{type:2,record:i,key:"fencedDiv",spec:{options:Ie},update:{internal:!0,deep:!0},callback:(e,t)=>t.reconfigureDelimLookup()}]}]},{id:"formatting",heading:"Formatting",collapsible:!0,items:[{name:"Make it tidier",desc:"If turned on, formatting will run in refined way by detecting context the cursor or selection was placed within, e.g. you just place a cursor to specific word and run the command to format the whole word or vice-versa. If turned off, formatting is more like a normal auto-wrap toggle and doesn't care about the context.",fields:[{type:0,record:i,key:"tidyFormatting",spec:null}]},{name:"Open tag menu after formatting",desc:"Will automatically open tag menu after doing formatting via command palattes or context menu. Only applied to the custom highlight, custom span, and fenced div.",fields:[{type:0,record:i,key:"openTagMenuAfterFormat",spec:null}]},{name:"No styled fenced div in source mode",desc:"Prevent any fenced divs being styled in source mode.",fields:[{type:0,record:i,key:"noStyledDivInSourceMode",spec:null,update:{internal:!0}}]}]},{id:"tag-display",heading:"Tag display behavior",collapsible:!0,items:[{name:"Highlight tag in live-preview mode",desc:"Tags can either always be visible, or when they meet particular condition.",fields:[{type:2,record:i,key:"hlTagDisplayBehaviour",spec:{options:gi},update:{internal:!0}}]},{name:"Custom span tag in live-preview mode",desc:"Tags can either always be visible, or when they meet particular condition.",fields:[{type:2,record:i,key:"spanTagDisplayBehaviour",spec:{options:gi},update:{internal:!0}}]},{name:"Highlight tag in preview mode",desc:"Show or hide highlight color tag in the preview mode.",fields:[{type:0,record:i,key:"showHlTagInPreviewMode",spec:null,update:{internal:!0}}]},{name:"Custom span tag in preview mode",desc:"Show or hide custom span tag in the preview mode.",fields:[{type:0,record:i,key:"showSpanTagInPreviewMode",spec:null,update:{internal:!0}}]},{name:"Always show fenced div tag",desc:"By default, the tag is always hidden in the preview mode, and only displayed when touching the cursor or selection in the live preview mode.",fields:[{type:2,record:i,key:"alwaysShowFencedDivTag",spec:{options:Or},update:{internal:!0,deep:!0}}]}]},{id:"custom-highlight",heading:"Custom highlight",collapsible:!0,items:[{name:"Color button",desc:"Display a button after highlight opening delimiter, used to open the color menu.",fields:[{type:0,record:i,key:"colorButton",spec:null,update:{internal:!0}}]},{name:"Show accent option",desc:"Show accent option in the color menu.",fields:[{type:0,record:i,key:"showAccentColor",spec:null}]},{name:"Show default option",desc:"Show default option in the color menu. Default means non-tagged highlight.",fields:[{type:0,record:i,key:"showDefaultColor",spec:null}]},{name:"Show remove option",desc:"Show remove option in the color menu.",fields:[{type:0,record:i,key:"showRemoveColor",spec:null}]},{name:"Color opacity in light mode",desc:"Adjust highlight opacity in light mode. Zero means that will be fully transparent.",fields:[{type:6,record:i,key:"lightModeHlOpacity",spec:{min:0,max:1,step:.01},callback:(e,t)=>{t.setHlOpacity(e.getValue(),0)}}]},{name:"Color opacity in dark mode",desc:"Adjust highlight opacity in dark mode. Zero means that will be fully transparent.",fields:[{type:6,record:i,key:"darkModeHlOpacity",spec:{min:0,max:1,step:.01},callback:(e,t)=>{t.setHlOpacity(e.getValue(),1)}}]},{name:"Color palettes",desc:"The first text field gives the name of the item in the color menu, and the second one sets the tag string to be used in highlight syntax.",preservedForTagSettings:5}]},{id:"custom-span",heading:"Custom span",collapsible:!0,items:[{name:"Show default option",desc:"Show default option in the tag menu. Default means non-tagged span.",fields:[{type:0,record:i,key:"showDefaultSpanTag",spec:null}]},{name:"Show remove option",desc:"Show remove option in the tag menu.",fields:[{type:0,record:i,key:"showRemoveSpanTag",spec:null}]},{name:"Predefined tags",desc:"Predefined tags to be displayed in the tag menu. The first field gives the name of the item, the second one sets the tag string to be used in custom span syntax.",preservedForTagSettings:6}]},{id:"fenced-div",heading:"Fenced div",collapsible:!0,items:[{name:"Show default option",desc:"Show default option in the tag menu. Default means non-tagged div.",fields:[{type:0,record:i,key:"showDefaultDivTag",spec:null}]},{name:"Show remove option",desc:"Show remove option in the tag menu.",fields:[{type:0,record:i,key:"showRemoveDivTag",spec:null}]},{name:"Predefined tags",desc:"Predefined tags to be displayed in the tag menu. The first field gives the name of the item, the second one sets the tag string to be used in fenced div syntax.",preservedForTagSettings:7}]},{id:"others",heading:"Others",collapsible:!0,items:[{name:"Delimiter escaping",desc:"Use backslash as a delimiter escaper. Works only in the editor mode.",fields:[{type:0,record:i,key:"editorEscape",spec:null,update:{internal:!0,deep:!0}}]},{name:"Parse exported PDF",desc:"Parse syntax on an exported PDF.",fields:[{type:0,record:i,key:"decoratePDF",spec:null}]}]}];function Ei(i,e,t,n){return i.addButton(r=>{r.setButtonText(e),r.onClick(n),t&&r.setCta()}),i}function Pr(i){for(let e=i.nextElementSibling;e!=null&&e.hasClass("is-collapsible");e=e.nextElementSibling)e.hasClass("collapsed")?e.removeClass("collapsed"):e.addClass("collapsed")}var It=class extends we.PluginSettingTab{constructor(t,n){super(t,n);d(this,"plugin");d(this,"tagSettingItems",{5:[],6:[],7:[]});d(this,"collapsedGroups",{"syntax-switch":!0,formatting:!0,"tag-display":!0,"custom-highlight":!0,"custom-span":!0,"fenced-div":!0,others:!0});d(this,"refreshInternal",!1);d(this,"deeplyRefreshInternal",!1);d(this,"isHidden",!0);this.plugin=n}saveSettings(t){this.plugin.saveSettings(),t!=null&&t.internal&&(this.refreshInternal=!0,t!=null&&t.deep&&(this.deeplyRefreshInternal=!0))}display(){let{containerEl:t}=this,{settings:n}=this.plugin,r=Ti(n);this.drawFromConfig(r,t),this.isHidden=!1}hide(){this.refreshInternal&&this.plugin.refreshMarkdownView(this.deeplyRefreshInternal),this.refreshInternal=this.deeplyRefreshInternal=!1,this.emptyTagSettingItems(),this.isHidden=!0,this.containerEl.empty(),super.hide()}emptyTagSettingItems(){for(let t of[5,6,7])this.tagSettingItems[t].splice(0)}removeSetting(t){t.clear(),t.settingEl.remove()}drawFromConfig(t,n){for(let r of t){let o=this.collapsedGroups[r.id];r.heading&&this.drawHeading(r,n);for(let a of r.items)this.drawSettingItem(a,n,r.collapsible,o),a.preservedForTagSettings==5?this.drawTagSettings(n,bi,r.collapsible,o):a.preservedForTagSettings==6?this.drawTagSettings(n,vi,r.collapsible,o):a.preservedForTagSettings==7&&this.drawTagSettings(n,Si,r.collapsible,o)}}drawHeading(t,n){if(!t.heading)return;let r=new we.Setting(n).setHeading().setName(t.heading);t.desc&&r.setDesc(t.desc),t.collapsible&&(r.addExtraButton(o=>{let a=o.extraSettingsEl;o.setIcon("chevron-down").onClick(()=>{let s=o.extraSettingsEl;Pr(r.settingEl),s.hasClass("collapsing")?(o.setTooltip("Collapse",{placement:"bottom"}),s.removeClass("collapsing"),delete this.collapsedGroups[t.id]):(o.setTooltip("Expand",{placement:"bottom"}),s.addClass("collapsing"),this.collapsedGroups[t.id]=!0)}),a.addClass("collapse-button","ems-button"),this.collapsedGroups[t.id]?(a.addClass("collapsing"),o.setTooltip("Expand",{placement:"bottom"})):o.setTooltip("Collapse",{placement:"bottom"})}),r.controlEl.addClass("collapse-control"))}drawSettingItem(t,n,r,o){let a=new we.Setting(n).setName(t.name);if(t.desc&&a.setDesc(t.desc),r&&(a.setClass("is-collapsible"),o&&a.setClass("collapsed")),t.fields)for(let s of t.fields)s.type==0?this._setToggleField(s,a):s.type==2?this._setDropdownField(s,a):s.type==1?this._setMultiToggleField(s,a):s.type==6&&this._setSliderField(s,a)}drawTagSettings(t,n,r,o){let a=t.createDiv({cls:["setting-item","setting-group","ems-setting-group"]}),s=this.plugin.tagManager,l=s.configsMap[n.type],u=new we.Setting(t);l.forEach(c=>{this._setTagItem(n,c,l,a)}),Ei(u,n.addBtnPlaceholder,!1,()=>{var c;s.add(n.type),(c=this._setTagItem(n,l.at(-1),l,a).controlEl.querySelector(".ems-field-tag"))==null||c.focus()}),Ei(u,"Reset to default",!0,()=>{var c;this.tagSettingItems[n.type].forEach(h=>{this.removeSetting(h)}),this.tagSettingItems[n.type].splice(0),s.reset(n.type),l.forEach(h=>{this._setTagItem(n,h,l,a)}),(c=n.onResetted)==null||c.call(n,this)}),r&&(u.setClass("is-collapsible"),a.addClass("is-collapsible"),o&&(u.setClass("collapsed"),a.addClass("collapsed"))),this._makeDragable(a,c=>{var m;let{oldIndex:h,newIndex:p}=c;h===void 0||p===void 0||h==p||(s.move(n.type,h,p),(m=n.onMoved)==null||m.call(n,this,h,p))})}_setTagItem(t,n,r,o){var s;n.tag=n.tag.replaceAll(t.tagFilter,"");let a=new we.Setting(o).setClass("ems-setting-item").setClass("ems-tag-config").addExtraButton(l=>{l.extraSettingsEl.addClasses(["ems-button","ems-button-drag-handle"]),l.setIcon("grip-vertical"),l.setTooltip("Hold and drag to move",{placement:"left"})}).addText(l=>{l.setPlaceholder(t.nameFieldPlaceholder),l.setValue(n.name),l.inputEl.addClasses(["ems-field","ems-field-name"]),l.onChange(u=>{n.name=u,this.saveSettings()})}).addExtraButton(l=>{l.extraSettingsEl.addClasses(["ems-button","ems-button-delete"]),l.setIcon("trash"),l.setTooltip("Delete"),l.onClick(()=>{var h;let c=r.findIndex(p=>p==n);this.plugin.tagManager.remove(t.type,c),this.tagSettingItems[t.type].splice(c,1),this.removeSetting(a),this.saveSettings(),(h=t.onDelete)==null||h.call(t,this,c)})}).addExtraButton(l=>{l.extraSettingsEl.addClasses(["ems-button","ems-button-toggle-show-hide"]),l.setIcon(n.showInMenu?"eye":"eye-off"),l.setTooltip("Show/hide menu item"),l.onClick(()=>{n.showInMenu=!n.showInMenu,l.setIcon(n.showInMenu?"eye":"eye-off"),this.saveSettings()})}).addText(l=>{l.setPlaceholder(t.tagFieldPlaceholder),l.inputEl.addClasses(["ems-field","ems-field-tag"]),l.setValue(n.tag),l.onChange(u=>{var h;let c=r.findIndex(p=>p==n);n.tag=u.replaceAll(t.tagFilter,""),l.setValue(n.tag),this.saveSettings(),(h=t.onTagChange)==null||h.call(t,this,n,c)})});return(s=t.onAdd)==null||s.call(t,this,a,n),this.tagSettingItems[t.type].push(a),a}_setToggleField(t,n){n.addToggle(r=>{let{record:o,key:a}=t;r.setValue(o[a]),r.onChange(s=>{o[a]=s,this.saveSettings(t.update),t.callback&&t.callback(r,this.plugin)})})}_setDropdownField(t,n){n.addDropdown(r=>{let{record:o,key:a}=t;r.addOptions(t.spec.options),r.setValue(o[a].toString()),r.onChange(s=>{o[a]=parseInt(s),this.saveSettings(t.update),t.callback&&t.callback(r,this.plugin)})})}_setMultiToggleField(t,n){let{record:r,key:o}=t,a=r[o],s=t.spec.options,l=(()=>{let c=[];for(let h in s)c.push(h);return c})(),u=l.findIndex(c=>c===a.toString());n.addExtraButton(c=>{let{icon:h,tooltip:p}=s[a];c.setIcon(h),c.setTooltip(p!=null?p:""),c.onClick(()=>{u+1>=l.length?u=0:u++;let m=parseInt(l[u]),{icon:v,tooltip:E}=s[m];c.setIcon(v),c.setTooltip(E!=null?E:""),r[o]=m,this.saveSettings(t.update),t.callback&&t.callback(c,this.plugin)})})}_setSliderField(t,n){n.addSlider(r=>{let{record:o,key:a,spec:s}=t;r.setInstant(!1),r.setDynamicTooltip(),r.setLimits(s.min,s.max,s.step),r.setValue(o[a]),r.onChange(l=>{o[a]=l,this.saveSettings(t.update),t.callback&&t.callback(r,this.plugin)})})}_makeDragable(t,n){mi.create(t,{handle:".ems-button-drag-handle",animation:100,easing:"cubic-bezier(0.2, 0, 0, 1)",forceFallback:!0,fallbackOnBody:!0,fallbackClass:"ems-setting-item-dragged",fallbackTolerance:4,onEnd:n})}};var ne={7:{char:":",length:3,exactLen:!1,class:"fenced-div"}},C={1:{char:"+",length:2,exactLen:!0,allowSpace:!0,mustBeClosed:!0,class:"ins",getEl:()=>document.createElement("ins"),builtin:!1},2:{char:"|",length:2,exactLen:!0,allowSpace:!0,mustBeClosed:!0,class:"spoiler",getEl:()=>{let i=document.createElement("span");return i.addClass("spoiler"),i.addEventListener("click",e=>{let t=e.currentTarget,n=!t.hasClass("spoiler-revealed");t.toggleClass("spoiler-revealed",n)}),i},builtin:!1},3:{char:"^",length:1,exactLen:!0,allowSpace:!1,mustBeClosed:!0,class:"sup",getEl:()=>document.createElement("sup"),builtin:!1},4:{char:"~",length:1,exactLen:!0,allowSpace:!1,mustBeClosed:!0,class:"sub",getEl:()=>document.createElement("sub"),builtin:!1},5:{char:"=",length:2,exactLen:!1,allowSpace:!0,mustBeClosed:!1,class:"custom-highlight",getEl:()=>document.createElement("mark"),builtin:!0},6:{char:"!",length:2,exactLen:!0,allowSpace:!0,mustBeClosed:!0,class:"custom-span",getEl(){let i=document.createElement("span");return i.classList.add(C[6].class),i},builtin:!1}},z={ALL:(()=>{let i=[];for(let e in C)i.push(parseInt(e));for(let e in ne)i.push(parseInt(e));return i})(),ALL_BLOCK:(()=>{let i=[];for(let e in ne)i.push(parseInt(e));return i})(),ALL_INLINE:(()=>{let i=[];for(let e in C)i.push(parseInt(e));return i})(),SPACE_RESTRICTED_INLINE:(()=>{let i=[];for(let e in C){let t=Number.parseInt(e);C[t].allowSpace||i.push(t)}return i})(),SPACE_ALLOWED_INLINE:(()=>{let i=[];for(let e in C){let t=Number.parseInt(e);C[t].allowSpace&&i.push(t)}return i})(),NON_BUILTIN_INLINE:(()=>{let i=[];for(let e in C){let t=Number.parseInt(e);C[t].builtin||i.push(t)}return i})()};var K={},wt={"table-row":{query:"table-row",getOpen(i){for(;!i.name.includes("table-row-0");)i=i.prevSibling;return i}},url:{query:"url",getOpen(i){return i}},math:{query:"math",getOpen(i){var e,t,n,r;for(;!i.name.includes("math-begin");){let o=(r=(n=i.prevSibling)!=null?n:(t=(e=i.parent)==null?void 0:e.prevSibling)==null?void 0:t.lastChild)!=null?r:null;if(!o)return null;i=o}return i.to-i.from!=1?null:i}},link:{query:"link(?<=internal-link)|link(?=-start|end)",getOpen(i){for(;!i.name.includes("link-start");)i=i.prevSibling;return i}},"formatting-list":{query:"formatting-list",getOpen(i){return i.parent}},hr:{query:"hr",getOpen(i){return i}},"codeblock-begin":{query:"codeblock-begin",getOpen(i){return i}},"formatting-header":{query:"formatting-header",getOpen(i){return i=i.parent,i.name.includes("header-line")&&(i=i.prevSibling),i}},"formatting-quote":{query:"formatting-quote",getOpen(i){return i.parent}},"hmd-footnote":{query:"hmd-footnote",getOpen(i){return i.parent}}},_i=/(?:codeblock|html|math)-(?:begin|end)|comment-(?:start|end)|cdata|tag$/,nt=/table|code|formatting|escape|html|math|tag|url|barelink|atom|comment|string|meta|frontmatter|internal-link|hr(?!\w)/;var Ci=(()=>{let i="";for(let e in wt)i+=(i?"|":"")+wt[e].query;return new RegExp(i)})();var yi=/^\{([a-z0-9-]+)\}/i,Ii=/^\{([a-z0-9 -]+)\}/i,hn=/:{3,}(?=([a-z0-9 -]+))\1$/yi,ie={},wi=["internal-link","external-link","math","internal-embed","list-bullet","collapse-indicator"];function fn(i){for(let e in K)delete K[e];for(let e in ie)delete ie[e];i.insertion&2&&(K[C[1].char]=1),i.spoiler&2&&(K[C[2].char]=2),i.superscript&2&&(K[C[3].char]=3),i.subscript&2&&(K[C[4].char]=4),i.customHighlight&2&&(K[C[5].char]=5),i.customSpan&2&&(K[C[6].char]=6),i.insertion&1&&(ie[C[1].char]=1),i.spoiler&1&&(ie[C[2].char]=2),i.superscript&1&&(ie[C[3].char]=3),i.subscript&1&&(ie[C[4].char]=4),i.customSpan&1&&(ie[C[6].char]=6)}function He(i){return i>=1&&i<=6}function kt(i){return i>=5||i==7}function pn(i){return i.trim().replaceAll(/\s{2,}/g," ")}var Z=require("@codemirror/view");var Fn=require("obsidian"),de=require("@codemirror/state"),ae=require("@codemirror/view"),Ut=require("@codemirror/language");var Ni=require("@codemirror/state");function xi(i){let e=i.charCodeAt(0);return e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122}function ki(i,e){let t,n,r,o;return He(i)?({char:t,length:n,exactLen:r}=C[i],o=!1):({char:t,length:n,exactLen:r}=ne[i],o=!0),{char:t,length:n,exactLen:r,role:e,allowSpaceOnDelim:o}}function Di(i,e,t){let n=0,r=!1;for(;i[e+n]==t.char;)n++;if(t.exactLen&&n==t.length||!t.exactLen&&n>=t.length){let o;if(t.role==0)o=i[e+n];else if(t.role==1)o=i[e-1];else throw TypeError("");(t.allowSpaceOnDelim||o&&o!=" "&&o!="	")&&(r=!0)}return{valid:r,length:n}}function Nr(i,e,t){e.closeLen=t,e.to=i.globalOffset+t,i.advance(t),i.queue.resolve([e.type],!0,!1)}function mn(i,e){let t=i.offset,n=e.tagLen,r=i.lineStr,o=e.type==5;if(e.validTag){if(r[t-1]=="}")return;e.validTag=!1}if(e.tagLen==0){if(r[t]!="{")return;e.tagLen++,t++}for(let a=r[t];t<r.length&&!(!xi(a)&&a!="-"&&(a!=" "||o));a=r[++t])e.tagLen++;e.tagLen>1&&r[t]=="}"&&(e.validTag=!0,e.tagLen++),i.advance(e.tagLen-n)}function gn(i,e){e.validTag=!1;let t=e.openLen+e.tagLen,n=e.tagLen,r=i.lineStr;for(;t<r.length;){let o=r[t];if(o==" "||o=="-"||xi(o))e.tagLen++,t++;else break}i.advance(e.tagLen-n),t>=r.length?e.validTag=!0:i.queue.resolve([e.type],!1,!1)}var bn={block(i,e){if(!i.isBlockStart)return!1;let t=ki(e,0),{valid:n,length:r}=Di(i.lineStr,i.offset,t);if(i.advance(r),!n)return!1;let o={type:e,level:0,status:0,from:i.globalOffset-r,to:i.globalOffset-r,openLen:r,closeLen:0,tagLen:0,tagAsContent:!1,validTag:!1,closedByBlankLine:!1};return i.blockTokens.push(o),i.queue.push(o),gn(i,o),!0},inline(i,e){let t=i.queue.getToken(e),n=i.queue.isQueued(e)?1:0,r=ki(e,n),o=e==5,a=e==6,{valid:s,length:l}=Di(i.lineStr,i.offset,r);if(!s)return i.advance(l),!1;if(t)Nr(i,t,l);else{let u={type:e,level:1,status:0,from:i.globalOffset,to:i.globalOffset,openLen:l,closeLen:0,tagLen:0,tagAsContent:o||a,validTag:!1,closedByBlankLine:!1};i.inlineTokens.push(u),i.queue.push(u),i.advance(l),(o||a)&&mn(i,u)}return!0}};function vn(){nt.compile("table|code|formatting|html|math|tag|url|barelink|atom|comment|string|meta|frontmatter|hr(?!\\w)")}function Li(){nt.compile("table|code|formatting|escape|html|math|tag|url|barelink|atom|comment|string|meta|frontmatter|hr(?!\\w)")}function Sn(i,e,t,n){let r=null;return i.iterate({from:e,to:t,enter(o){if(n(o.node))return r=o.node,!1}}),r}function Tn(i,e){let t=null,n=null;return i.iterate({from:e,to:e,enter(r){if(r.name=="Document")return;let o=Ci.exec(r.name);if(o)return t=r.node,n=o[0],!1}}),t&&n?{node:t,type:n}:null}function En(i){var n;let e=i.name,t=0;if(i.name=="Document")return t;if(!i.name.startsWith("HyperMD")){if(i.parent.name=="Document")return t;i=i.parent}return e.startsWith("hr",8)?t=1:e.startsWith("header",8)?t=2:e.startsWith("quote",8)?t=3:e.startsWith("codeblock",8)?t=4:e.startsWith("list",8)?e.includes("nobullet")?t=6:t=5:e.startsWith("footnote",8)?(n=i.firstChild)!=null&&n.name.includes("footnote")?t=7:t=8:e.startsWith("table",8)&&(e.includes("table-row-1")?t=10:t=9),t}function _n(i){var n;let e=i.node,t=i.type;return(e=(n=wt[t])==null?void 0:n.getOpen(e))?e.from:null}function Cn(i,e,t){return!!Sn(i,e,t,r=>{let o=_i.exec(r.name);return o?!((o[0]=="math-begin"||o[0]=="math-end")&&r.to-r.from<2):!1})}var Ge=require("@codemirror/state");function rt(i){return"text"in i&&i.text instanceof Array}function xt(i){return i.children!==null}var ot=class extends Ge.Line{constructor(t,n,r,o){super();d(this,"from");d(this,"to");d(this,"number");d(this,"text");this.from=t,this.to=n,this.number=r,this.text=o}},Fe=class i{constructor(){d(this,"address");d(this,"curLine")}get doc(){return this.address[0].parent}next(){for(let e=this.address.length-1;e>=0;e--){let{parent:t,index:n}=this.address[e],r=rt(t)?t.text:t.children;if(n+1<r.length){if(this.address[e].index=++n,this.address.splice(e+1).length)for(;xt(t);)t=t.children[n],n=0,this.address.push({parent:t,index:n});if(!rt(t))throw TypeError("TextLeaf not found!");let o=t.text[n].length,a=this.curLine.to+1;return this.curLine=new ot(a,a+o,this.curLine.number+1,t.text[n]),!0}}return!1}prev(){for(let e=this.address.length-1;e>=0;e--)if(this.address[e].index>0){this.address[e].index--;let{parent:t,index:n}=this.address[e];if(this.address.splice(e+1).length&&xt(t))for(;;){let a;if(t=t.children[n],rt(t)?(a=!0,n=t.text.length-1):(a=!1,n=t.children.length-1),this.address.push({parent:t,index:n}),a)break}if(!rt(t))throw TypeError("TextLeaf not found!");let r=t.text[n].length,o=this.curLine.from-1;return this.curLine=new ot(o-r,o,this.curLine.number-1,t.text[n]),!0}return!1}goto(e){if(e<this.curLine.from)for(;e<this.curLine.from&&this.prev(););else if(e>this.curLine.to)for(;e>this.curLine.to&&this.next(););return this}gotoLine(e){if(e<this.curLine.number)for(;this.curLine.number!=e&&this.prev(););else if(e>this.curLine.number)for(;this.curLine.number!=e&&this.next(););return this}gotoLast(){this.address.splice(1);let{parent:e,index:t}=this.address[0],n=e;for(;xt(e);)t=e.children.length-1,n!==e?this.address.push({parent:e,index:t}):this.address[0].index=t,e=e.children[t];t=e.text.length-1,n!==e?this.address[0].index=t:this.address.push({parent:e,index:t});let r=e.text[t];return this.curLine={from:n.length-r.length,to:n.length,text:r,number:n.lines,length:r.length},this}getPrevLine(){if(!this.prev()||this.curLine.number<=1)return null;let e=this.curLine;return this.next(),e}getNextLine(){if(!this.next()||this.curLine.number>=this.doc.lines)return null;let e=this.curLine;return this.prev(),e}static atOffset(e,t){let{address:n,line:r}=Gr(e,t),o=new i;return o.address=n,o.curLine=r,o}};function Ar(i,e){let t=e instanceof Ge.Line?e:i.lineAt(e);return t.number>=i.lines?null:i.line(t.number+1)}function Lt(i,e,t=!0){let n=e instanceof Ge.Line?e:i.lineAt(e);for(;n.number<i.lines;)if(n=i.line(n.number+1),re(n)){t||(n=i.line(n.number-1));break}return n}function Ri(i,e,t=!1,n=!1){let r=[],o=i.lineAt(e.from),a=o,s;for(!re(o)&&t&&(s={start:Hr(i,o).number,end:o.number+1},r.push(s));e.to>=o.from&&(re(o)?s=void 0:s?s.end++:(s={start:o.number,end:o.number+1},r.push(s)),!(o.number>=i.lines));o=i.line(o.number+1));return s&&n&&(s.end=Lt(i,o,!1).number+1),r.length||r.push({start:a.number,end:a.number+1}),r}function Hr(i,e){let t=e instanceof Ge.Line?e:i.lineAt(e),n=t.number>1?i.line(t.number-1):null;if(re(t))return t;for(;n&&!re(n);)t=n,n=t.number>1?i.line(t.number-1):null;return t}function Fr(i,e){let t;return e instanceof Ge.Line?t=e.number:t=i.lineAt(e).number,t<=1?null:i.line(t-1)}function re(i){return!i.text.trimEnd()}function Oi(i,e){let t=Ar(i,e);return!t||re(t)}function Pi(i,e){let t=Fr(i,e);return!t||re(t)}function Gr(i,e){let t=i,n=[],r=0,o="",a=0;if(e<0||e>t.length)throw RangeError();for(;xt(t);){let l=t.children;for(let u=0;u<l.length;u++){let c=l[u];if(e>=a&&e<=a+c.length){n.push({parent:t,index:u}),t=c;break}a+=c.length+1,r+=c.lines}}if(!rt(t))throw TypeError();for(let l=0;l<t.text.length;l++){let u=t.text[l];if(r++,e>=a&&e<=a+u.length){n.push({parent:t,index:l}),o=u;break}a+=u.length+1}let s=new ot(a,a+o.length,r,o);return{address:n,line:s}}function Rt(i){let e=i.from+i.openLen,t=e+i.tagLen;return{from:e,to:t}}function $(i){let e={from:i.from,to:i.from+i.openLen},t={from:i.to-i.closeLen,to:i.to},n={from:e.to,to:e.to+i.tagLen},r={from:i.tagAsContent?n.from:n.to,to:t.from};return{openRange:e,closeRange:t,tagRange:n,contentRange:r}}function yn(i){var a,s;let{tokens:e,ranges:t,callback:n}=i,r=In(e,(s=(a=t[0])==null?void 0:a.from)!=null?s:0),o=0;if(r!==null)for(;r<e.length&&o<t.length;){if(t[o].to<=e[r].from){o++;continue}e[r].from<t[o].to&&e[r].to>t[o].from&&n(e[r]),r++}}function In(i,e){if(!i.length)return null;let t=32768,n=2,r=0;for(;t!==32;){if(i.length>t)for(;i[r].from<=e;){let o=Math.min(r+t,i.length);if(i[o-1].to<e)r=o;else break}t/=n,n*=2}for(let o=Math.min(r+t,i.length);r<o&&i[r].to<e;r++);return r<i.length?r:null}function Br(i,e){for(let t in K)if(i==t)return!0;return!!(e.fencedDiv&2&&i==":")}function Vr(i){if(i.empty)return null;let e,t,n;return i.iterChangedRanges((r,o,a,s)=>{e=e===void 0?r:Math.min(e,r),t=t===void 0?o:Math.max(t,o),n=n===void 0?s:Math.max(n,s)},!1),{from:e,initTo:t,changedTo:n,length:n-t}}function Ur(i,e,t){return Cn(e,i.from,i.changedTo)||Cn(t,i.from,i.initTo)}var wn=class{constructor(){d(this,"_tokenMap",{});d(this,"_state")}attachState(e){this._state=e,this._state.queue=this}detachState(){this._state.queue=void 0,this._state=void 0}isQueued(e){return!!this._tokenMap[e]}push(e){e.status=0,this._tokenMap[e.type]=e}getToken(e){var t;return(t=this._tokenMap[e])!=null?t:null}resolve(e,t,n,r=this._state.globalOffset){for(let o of e){let a=this.getToken(o);a&&(a.level==1?!t&&C[o].mustBeClosed?a.status=2:a.status=1:a.validTag?a.status=1:a.status=2,t||(a.to=r,a.closedByBlankLine=n),delete this._tokenMap[o])}}resolveAll(e,t=this._state.globalOffset){this.resolve(z.ALL,!1,e,t)}clear(){this._tokenMap={}}},kn=class{constructor(e,t,n){d(this,"doc");d(this,"tree");d(this,"settings");d(this,"textCursor");d(this,"endOfStream");d(this,"cursor");d(this,"line");d(this,"offset");d(this,"isBlockStart");d(this,"inlineTokens");d(this,"blockTokens");d(this,"queue");d(this,"curCtx",0);d(this,"prevCtx",0);var o;this.doc=e.doc,this.tree=e.tree,this.textCursor=Fe.atOffset(this.doc,e.startAt),this.line=this.textCursor.curLine,this.offset=e.startAt-this.line.from,this.inlineTokens=t,this.blockTokens=n,this.cursor=this.tree.cursor(),this.settings=e.settings,this.nextCursor(),this.endOfStream=e.stopAt instanceof Ni.Line?e.stopAt.number:this.doc.lineAt((o=e.stopAt)!=null?o:this.tree.length).number;let r=this.prevLine;this.isBlockStart=r?re(r):!0}get globalOffset(){return this.offset+this.line.from}get linePos(){return this.line.number}get lineStr(){return this.line.text}get char(){let e=this.line.text[this.offset];return!e&&!this.isLastLine()?`
`:e!=null?e:""}get prevLine(){return this.textCursor.getPrevLine()}advance(e=1){let t=this.lineStr.length-this.offset;return t?(e>t?this.offset+=t:this.offset+=e,!0):(this.queue.resolve(z.SPACE_RESTRICTED_INLINE,!1,!1),!1)}setGlobalOffset(e){e>this.doc.length?(this.line=this.textCursor.gotoLast().curLine,this.offset=this.line.length):(this.line=this.doc.lineAt(e),this.offset=e-this.line.from)}isSpace(e=0){let t=this.lineStr[this.offset+e];return t==" "||t=="	"||!t}seekWhitespace(e=this.line.length){let t=this.offset;for(let n=this.line.text[t];t<e;n=this.line.text[++t])if(n==" "||n=="	")return t;return null}advanceLine(e=!0){return this.linePos>=this.endOfStream?(this.queue.resolveAll(!1),null):(this.textCursor.next(),this.line=this.textCursor.curLine,this.offset=0,this.isBlockStart=!1,this.resolveContext(),e&&this.trySkipBlankLine(),this.line)}trySkipBlankLine(){if(this.isBlankLine()){for(this.isBlockStart=!0,this.queue.resolveAll(!0,this.line.to);this.linePos<this.endOfStream&&(this.textCursor.next(),this.line=this.textCursor.curLine,!!this.isBlankLine()););return this.resolveContext(),!0}return!1}isLastLine(){return this.line.number>=this.doc.lines}isBlankLine(){return re(this.line)}nextCursor(e=!0){if(this.cursor){if(this.cursor.next(e)&&this.cursor.name!="Document")return!0;this.cursor=null}return!1}cursorPos(e=0){let t=this.globalOffset;return this.cursor?t<this.cursor.from?"after":t>this.cursor.to+e?"before":"touch":null}processCursor(){let e=this.cursorPos(-1);for(;e=="before";)this.nextCursor(),e=this.cursorPos(-1);if(e!="touch")return null;let t=this.cursor.name;return t.includes("formatting-highlight")?"hl_delim":t.includes("table-sep")?"table_sep":nt.test(t)?"skipped":null}skipCursorRange(){if(!this.cursor)return!1;let e=this.cursor.to-this.line.from,t=this.seekWhitespace(e);return t!==null&&(this.offset=t,this.queue.resolve(z.SPACE_RESTRICTED_INLINE,!1,!1)),this.offset=e,!0}getContext(e=this.line){if(e.number!=this.linePos){let t=Sn(this.tree,e.from,e.from,n=>{var r;return((r=n.parent)==null?void 0:r.name)=="Document"});if(t)return En(t)}else if(this.cursorPos()=="touch"){let t=this.cursor.node;return En(t)}return 0}setContext(e){this.prevCtx=this.curCtx,this.curCtx=e}resolveContext(){for(;this.cursorPos()=="before";)this.nextCursor();this.setContext(this.getContext());let e=!1,t=!1,n=!1,r=this.line.from;switch(this.curCtx){case 1:case 4:case 10:e=!0,t=!0;break;case 3:this.prevCtx!=3&&(t=!0);break;case 5:n=!0;case 2:case 7:t=!0;break}switch(this.prevCtx){case 2:case 9:t=!0,r-=1}this.offset||(t&&(this.queue.resolve(z.ALL_BLOCK,!1,!1,r),this.queue.resolve(z.NON_BUILTIN_INLINE,!1,!1,r),this.isBlockStart=!0),n&&this.queue.resolve([5],!1,!1,r)),e&&this.skipCursorRange(),this.curCtx&&this.nextCursor()}},Ot=class{constructor(e){d(this,"_state");d(this,"_queue",new wn);d(this,"_changeSet",null);d(this,"inlineTokens",[]);d(this,"blockTokens",[]);d(this,"reparsedRanges");d(this,"lastStreamPoint",{from:0,to:0});d(this,"oldTree");d(this,"lastStop");d(this,"settings");this.settings=e,e.editorEscape||vn()}getTokens(e){return e==1?this.inlineTokens:this.blockTokens}hasStoredChanges(){return!!this._changeSet}storeChanges(e){this._changeSet=this._changeSet?this._changeSet.compose(e):e}initParse(e,t,n){this.settings.editorEscape?Li():vn(),this.lastStreamPoint.from=0,this.inlineTokens=[],this.blockTokens=[],this._defineState({doc:e,tree:t,startAt:0,stopAt:n,settings:this.settings}),this._streamParse(),this.reparsedRanges={1:{from:0,initTo:0,changedTo:this.inlineTokens.length},0:{from:0,initTo:0,changedTo:this.blockTokens.length}},this.oldTree=t,this.lastStop=n!=null?n:t.length,this._changeSet=null}applyChange(e,t,n=t.length){let r=this._changeSet?Vr(this._changeSet):null,o=this.lastStop==n?n:Math.min(n,this.lastStop)+1;this._changeSet=null,r&&(o=Math.min(o,r.from));let a=r&&Ur(r,t,this.oldTree)?Lt(e,r.changedTo):Lt(e,n),s={doc:e,tree:t,startAt:o,stopAt:a,settings:this.settings};this._defineState(s);let l={inline:this._getLeftTokens(this._filterTokens(this.inlineTokens,this.reparsedRanges[1]),r,a),block:this._getLeftTokens(this._filterTokens(this.blockTokens,this.reparsedRanges[0]),r,a)};this._shiftOffset(),this._remapLeftTokens(l.inline,r),this._remapLeftTokens(l.block,r),this._streamParse(),this.reparsedRanges[1].changedTo=this.inlineTokens.length,this.reparsedRanges[0].changedTo=this.blockTokens.length,this.inlineTokens=this.inlineTokens.concat(l.inline),this.blockTokens=this.blockTokens.concat(l.block),this.oldTree=t,this.lastStop=n!=null?n:t.length}_defineState(e){this._state=new kn(e,this.inlineTokens,this.blockTokens),this._queue.attachState(this._state),this.oldTree&&this._shiftOffsetByNode()}_shiftOffsetByNode(){let e=this._state.globalOffset,t=Tn(this._state.tree,e),n=Tn(this.oldTree,e),r=null;if(t&&(r=_n(t)),n){let o=_n(n);o!==null&&(r===null||o<r)&&(r=o)}return r!==null?(this._state.setGlobalOffset(r),!0):!1}_shiftOffset(){if(this._state.offset==0)return!1;let e=this._state.offset-1,t=this._state.lineStr,n=t[e];if(Br(n,this.settings)){for(;t[e-1]==n;)e--;return this._state.offset=e,!0}return!1}_detachState(){this._queue.detachState(),this._state=void 0}_streamParse(){let e,t=this._state;this.lastStreamPoint.from=t.globalOffset,(e=this._state.prevLine)&&t.setContext(t.getContext(e)),t.trySkipBlankLine()||t.resolveContext();do this._parseLine();while(t.advanceLine());this.lastStreamPoint.to=t.globalOffset,this._queue.clear(),this._detachState()}_parseLine(){let e=this._state;for(this.settings.fencedDiv&2&&this._state.offset==0&&e.isBlockStart&&bn.block(e,7);;){e.isSpace()&&e.queue.resolve(z.SPACE_RESTRICTED_INLINE,!1,!1);let t=e.processCursor(),n=K[e.char];if(t=="skipped")e.skipCursorRange();else if(t=="table_sep")e.queue.resolve(z.ALL_INLINE,!1,!1),e.advance();else if(n&&(n!=5||t=="hl_delim"))bn.inline(e,n);else if(!e.advance())break}}_filterTokens(e,t){var s;let n,r,o=this._state.globalOffset,a=(s=In(e,o))!=null?s:e.length;for(let l=e[a];a<e.length;l=e[++a]){if(l.to<o)continue;let{openRange:u,tagRange:c}=$(l);if(u.to<o)l.to=l.from,l.closeLen=0,n!=null||(n=a),this._queue.push(l),l.tagLen&&c.to>=o&&(l.tagLen=o-c.from,l.type==6||l.type==5?mn(this._state,l):l.type==7&&gn(this._state,l));else{r=a+1;break}}return n!=null||(n=a),t.from=n,t.initTo=r!=null?r:a,e.splice(a)}_getLeftTokens(e,t,n){let r=0,o=t==null?void 0:t.length;if(o===void 0)return[];for(;r<e.length&&e[r].to<=n.to-o;)r++;return e.slice(r)}_remapLeftTokens(e,t){if(!e||!t)return;let n=t.changedTo-t.initTo;for(let r=0,o=e[r];r<e.length;o=e[++r])o.from+=n,o.to+=n}};function Pt(i,e){let t=[];for(let n=0,r=0;n<i.length||r<e.length;){if(!e[r]||i[n]&&i[n].to<e[r].from){t.push(Object.assign({},i[n])),n++;continue}if(!i[n]||e[r]&&e[r].to<i[n].from){t.push(Object.assign({},e[r])),r++;continue}t.push({from:Math.min(i[n].from,e[r].from),to:Math.max(i[n].to,e[r].to)}),n++,r++}return t}function Dn(i,e){return i>=e.from&&i<=e.to}var Nt=class{constructor(e){d(this,"selectedRegions",{1:[],0:[]});d(this,"changedRegions",{1:[],0:[]});d(this,"filterRegions",{1:[],0:[]});d(this,"_indexCaches",{1:{number:0},0:{number:0},selection:{number:0}});d(this,"_maps",[]);d(this,"selection");d(this,"parser");this.parser=e}observe(e,t,n=!1){this.selection=e,this._checkIndexCache();for(let r=0;r<=1;r++){let o=this.selectedRegions[r];this._locateSelectedTokens(r),r!=1&&(this._mapChangedRegion(r,o,t,n),this.createFilter(r))}}restartObserver(e,t){this.selectedRegions={0:[],1:[]},this.observe(e,t,!0)}_locateSelectedTokens(e){var r,o;let t=[],n;return this._clearMaps(),this._lookBehind(e,(a,s,l)=>{var u;(u=this._maps[l])!=null&&u[e]?this._maps[l][e].unshift(s):this._maps[l]={[e]:[s]},!n||n.from!=s+1?(n={from:s,to:s+1},t.unshift(n)):n.from--}),n=t.at(-1),this._lookAhead(e,(a,s,l)=>{var u;(u=this._maps[l])!=null&&u[e]?this._maps[l][e].push(s):this._maps[l]={[e]:[s]},!n||n.to!=s?(n={from:s,to:s+1},t.push(n)):n.to++}),this._indexCaches[e].number=(o=(r=t[0])==null?void 0:r.from)!=null?o:this._indexCaches[e].number,this.selectedRegions[e]=t}_checkIndexCache(){this._indexCaches[1].number>=this.parser.inlineTokens.length&&(this._indexCaches[1].number=Math.max(this.parser.inlineTokens.length-1,0)),this._indexCaches[0].number>=this.parser.blockTokens.length&&(this._indexCaches[0].number=Math.max(this.parser.blockTokens.length-1,0))}_lookBehind(e,t){let n=this.selection.ranges,r=n.length-1,o=this.parser.getTokens(e),a=n[0].from;for(let s=this._indexCaches[e].number-1;s>=0&&a<=o[s].to;s--){for(;n[r].from>o[s].to;)r--;if(!n[r])break;n[r].to<o[s].from||t(o[s],s,r)}}_lookAhead(e,t){let n=this.selection.ranges,r=0,o=this.parser.getTokens(e),a=n.at(-1).to;for(let s=this._indexCaches[e].number;s<o.length&&a>=o[s].from;s++){for(;n[r].to<o[s].from;)r++;if(!n[r])break;n[r].from>o[s].to||t(o[s],s,r)}}_mapChangedRegion(e,t,n,r){let o=this.parser.reparsedRanges[e],a=o.changedTo-o.initTo,s=[],l=o.from!=o.changedTo,u=this.parser.getTokens(e).length;if(r)return this.changedRegions[e]=u?[{from:0,to:u}]:[];if(!n||o.from==o.initTo&&!a)return this.changedRegions[e]=Pt(t,this.selectedRegions[e]);if(!t.length)return l?this.changedRegions[e]=Pt([{from:o.from,to:o.changedTo}],this.selectedRegions[e]):this.changedRegions[e]=this.selectedRegions[e];for(let c=0,h=!1;c<t.length;)if(t[c].to<o.from){if(s.push(Object.assign({},t[c])),++c>=t.length){l&&s.push({from:o.from,to:o.changedTo});break}}else if(t[c].from<o.initTo){h=!0;let p=Math.min(o.from,t[c].from),m=Math.max(o.changedTo,t[c].to+a);p!=m&&s.push({from:p,to:m});do c++;while(c<t.length&&t[c].from<o.initTo)}else{!h&&l&&s.push({from:o.from,to:o.changedTo});do s.push({from:t[c].from+a,to:t[c].to+a}),c++;while(c<t.length)}return this.changedRegions[e]=Pt(s,this.selectedRegions[e])}_clearMaps(){this._maps=new Array(this.selection.ranges.length).map(()=>({}))}_checkSelectionIndexCache(){this._indexCaches.selection.number>=this.selection.ranges.length&&(this._indexCaches.selection.number=this.selection.ranges.length-1)}createFilter(e){let t=e==1?this.parser.inlineTokens:this.parser.blockTokens;if(!t.length)return this.filterRegions[e]=[Object.assign({},this.parser.lastStreamPoint)];let n=[],r=this.changedRegions[e],o=e==1?1:0;for(let a=0;a<r.length;a++){let s=r[a],l,u;s.to>t.length?(s.from>=t.length?l=this.parser.lastStreamPoint.from:l=t[s.from].from+o,u=this.parser.lastStreamPoint.to):(l=t[s.from].from+o,u=t[s.to-1].to-o),n.push({from:l,to:u})}return this.filterRegions[e]=n}iterateChangedRegion(e,t){let n=this.parser.getTokens(e),r=this.changedRegions[e],o=this.selectedRegions[e];for(let a=0,s=0;a<r.length;a++){let l=r[a];for(let u=l.from;u<l.to;u++){let c=!1;o[s]&&o[s].to<=u&&s++,o[s]&&o[s].from<=u&&(c=!0),n[u]&&(t==null||t(n[u],u,n,c))}}}iterateSelectedRegion(e,t,n){let r=this.parser.getTokens(e),o=this.selection.ranges,a=this.selectedRegions[e];for(let s=0,l=0;s<a.length;s++){let u=a[s];for(let c=u.from;c<u.to;c++){let h=r[c],p;for(let m=l-1;m>=0&&!(o[m].to<h.from);m--)o[m].from<=h.to&&(l=m);for(;h.to<o[l].from;)l++;for(;o[l]&&h.to>=o[l].from;)t&&(p!="covered"&&h.from>=o[l].from&&h.to<=o[l].to?p="covered":p!="covering"&&h.from<o[l].from&&h.to>o[l].to?p="covering":p===void 0&&(h.from==o[l].to||h.to==o[l].from)?p="adjacent":(p===void 0||p==="adjacent")&&(p="intersect")),l++;if((n==null?void 0:n(h,c,r,p))===!1)return}}}touchSelection(e,t){var a;this._checkSelectionIndexCache();let n=this.selection.ranges,r=this._indexCaches.selection,o=(a=n[r.number])!=null?a:n.at(-1);if(t<o.from){for(;r.number>=0;){if(e<=o.to&&t>=o.from)return!0;o=n[--r.number]}r.number=0}else if(e>o.to){for(;r.number<n.length;){if(e<=o.to&&t>=o.from)return!0;o=n[++r.number]}r.number=n.length-1}else return!0;return!1}pickMaps(e){let t=He(e)?1:0,n=this.parser.getTokens(t);return this._maps.map(r=>{var o;return(o=r[t])==null?void 0:o.filter(a=>n[a].type==e)})}};var N=require("@codemirror/state"),oe=require("@codemirror/view"),at=require("obsidian");var be=require("@codemirror/view");var Mt=require("obsidian"),At=require("@codemirror/view");function Wr(i){var e;return((e=i.workspace.getMostRecentLeaf())==null?void 0:e.view.getViewType())=="canvas"}function qr(i){return Wr(i)?i.workspace.activeEditor:null}function Mi(i){let e=qr(i),t=e==null?void 0:e.containerEl;return t?t.getBoundingClientRect():null}function Ai(i,e,t){i.addItem(n=>{let r=n.setSubmenu(),o=e.activeCm||e.cm,a={},s=Ln;if(r.onload=function(){Mt.Platform.isMobile||r.registerDomEvent(r.dom,"mouseover",()=>{var u;r.currentSubmenu&&r.currentSubmenu!==((u=r.items[r.selected])==null?void 0:u.submenu)&&(r.closeSubmenu(),r.openSubmenuSoon(r.items[r.selected]))})},!(o instanceof At.EditorView))throw ReferenceError("EditorView not found");o.state.facet(W).observer.iterateSelectedRegion(1,!0,(u,c,h,p)=>{let m=u.type;u.status!=1||a[m]||(p=="covered"||p=="covering")&&(a[m]=!0)}),r.addSections(["selection-extended-inline","selection-extended-block"]),n.setTitle("More format..."),n.setIcon("paintbrush-vertical"),n.setSection("selection");for(let u=0;u<s.length;u++)r.addItem(c=>{let h=s[u].type;if(c.setTitle(s[u].ctxMenuTitle),c.setIcon(s[u].icon),c.setSection("selection-extended-inline"),a[h]&&c.setChecked(!0),h==5||h==6){let p=c.setSubmenu();Q.bindMenu(p,o,h)}c.onClick(()=>{s[u].editorCallback(e,t),i.close()})})})}var Q=class extends Mt.Menu{constructor(t,n){super();d(this,"mainPlugin");d(this,"itemIndexCache",{number:0});d(this,"view");d(this,"type");d(this,"formatter");d(this,"CLS_PREFIX","ems-menu-item");d(this,"ICON");this.constructMenu(t,n)}constructMenu(t,n){let r=t.state.facet(W);this.view=t,this.type=n,this.formatter=r.formatter,this.mainPlugin=r.mainPlugin,this.bindIndexCache(),this.setClassPrefix(),this.setIcon(),this.addConfigs(this.getConfigs()),this.addDefaultItem(),this.addRemoveItem(),this.dom.addClass("ems-menu","ems-tag-menu"),n==5&&this.dom.addClass("ems-color-menu")}setClassPrefix(){this.type==5?this.CLS_PREFIX+=" ems-highlight-":this.type==6?this.CLS_PREFIX+=" ems-span-":this.type==7&&(this.CLS_PREFIX+=" ems-div-")}setIcon(){this.type==5?this.ICON="palette":this.ICON="shapes"}bindIndexCache(){let t=this.view.state.facet(xn);switch(this.type){case 5:this.itemIndexCache=t.colorMenuItem;break;case 6:this.itemIndexCache=t.spanTagMenuItem;break;case 7:this.itemIndexCache=t.divTagMenuItem;break;default:this.itemIndexCache={number:0}}}getConfigs(){let t=[],{settings:n}=this.mainPlugin;return this.type==5?t=n.colorConfigs:this.type==6?t=n.predefinedSpanTag:this.type==7&&(t=n.predefinedDivTag),t}addConfigs(t){let{settings:n}=this.mainPlugin;t.forEach(({name:r,tag:o,showInMenu:a})=>{a&&this.addConfigItem(r,this.ICON,this.CLS_PREFIX+o,()=>{this.format(o)})}),this.type==5&&n.showAccentColor&&this.addConfigItem("Accent",this.ICON,this.CLS_PREFIX+"accent",()=>{this.format("accent")})}addConfigItem(t,n,r,o){this.addItem(a=>{a.setTitle(t),a.setIcon(n),a.dom.addClass(...r.split(" ")),a.onClick(s=>{let l=this.items.findIndex(u=>u==a);this.itemIndexCache.number=l,o(s)})})}addDefaultItem(){let{settings:t}=this.mainPlugin;(this.type==5&&t.showDefaultColor||this.type==6&&t.showDefaultSpanTag)&&this.addConfigItem("Default",this.ICON,this.CLS_PREFIX+"default",()=>{this.format("")})}addRemoveItem(){let{settings:t}=this.mainPlugin;(this.type==5&&t.showRemoveColor||this.type==6&&t.showRemoveSpanTag)&&this.addConfigItem("Remove","eraser","ems-menu-item ems-remove",()=>{this.removeFormatting()})}format(t){this.formatter.startFormat(this.view,this.type,t)}removeFormatting(){this.formatter.startFormat(this.view,this.type,void 0,!0)}showMenu(){this.checkItemIndexCache(),this.view.requestMeasure({read:t=>{let n=this.mainPlugin.app,r=Mi(n),o=t.state.selection.ranges.at(-1).to,a=t.coordsForChar(o);if(!a){let s=t.contentDOM.getBoundingClientRect(),l=t.lineBlockAt(o),u=t.textDirection==At.Direction.RTL;a={top:s.top,bottom:s.top+l.height,left:u?s.right:s.left,right:u?s.left:s.right}}return{charCoords:a,canvasNodeCoords:r}},write:t=>{let{charCoords:n,canvasNodeCoords:r}=t;if(n){let o={x:n.left,y:n.bottom};r&&(o.x+=r.x,o.y+=r.y),this.showAtPosition(o),this.select(this.itemIndexCache.number)}}})}checkItemIndexCache(){this.itemIndexCache.number>=this.items.length&&(this.itemIndexCache.number=this.items.length-1)}static bindMenu(t,...n){let r=["addConfigItem","addConfigs","bindIndexCache","checkItemIndexCache","constructMenu","format","removeFormatting","showMenu","setClassPrefix","setIcon","addDefaultItem","addRemoveItem","getConfigs"];for(let o of r)Object.defineProperty(t,o,{value:this.prototype[o].bind(t)});return Object.defineProperty(t,"CLS_PREFIX",{value:"ems-menu-item",configurable:!0,writable:!0}),t.constructMenu(...n),t}static create(...t){let[n,r]=t;if(!kt(r))throw new TypeError("This format type doesn't support custom tag.");return new this(n,r)}};var Ht=class i extends be.WidgetType{constructor(t){super();d(this,"_btnPos");d(this,"_colorMenu");this._btnPos=t.from+t.openLen}eq(t){return this._btnPos==t._btnPos}toDOM(t){let n=document.createElement("span");return n.setAttribute("aria-hidden","true"),n.className="cm-highlight-color-btn",n.onclick=()=>{t.dispatch({selection:{anchor:this._btnPos}}),this._colorMenu||(this._colorMenu=Q.create(t,5)),this._colorMenu.showMenu()},n}ignoreEvent(){return!1}static of(t){let n=t.from+t.openLen;return be.Decoration.widget({widget:new i(t),side:1}).range(n)}},ke=class i extends be.WidgetType{constructor(t){super();d(this,"_token");this._token=t}eq(t){return t._token==this._token}toDOM(){return document.createElement("span")}static of(t,n,r,o=!1){return be.Decoration.replace({widget:new i(r),block:o,inclusiveEnd:!1}).range(t,n)}},Ft=class i extends be.WidgetType{constructor(t){super();d(this,"_offset");this._offset=t}eq(t){return t._offset===this._offset}toDOM(){return document.createElement("br")}static of(t){return be.Decoration.replace({widget:new i(t)}).range(t-1,t)}};var Hi=require("@codemirror/view");var Fi=Hi.Decoration.mark({class:"cm-spoiler-revealed"});function Kr(i,e){return oe.Decoration.mark({class:e,token:i}).range(i.from,i.to)}var Rn=class{constructor(){d(this,"inlineSet",N.RangeSet.empty);d(this,"blockSet",N.RangeSet.empty);d(this,"inlineOmittedSet",N.RangeSet.empty);d(this,"blockOmittedSet",N.RangeSet.empty);d(this,"colorBtnSet",N.RangeSet.empty);d(this,"revealedSpoilerSet",N.RangeSet.empty);d(this,"lineBreaksSet",N.RangeSet.empty)}},On=class{constructor(e,t){d(this,"_selectionObserver");d(this,"_settings");this._settings=e,this._selectionObserver=t}omitBlock(e,t){let n=[],r=this._selectionObserver.filterRegions[0];if(this._selectionObserver.iterateChangedRegion(0,(o,a,s,l)=>{if(l||o.status!=1||!o.validTag)return;let u=o.from,c=u+o.openLen+o.tagLen;o.to>c&&c++,n.push(ke.of(u,c,o,!0))}),!(e!=null&&e.size))e=oe.Decoration.set(n);else{t&&(e=e.map(t));for(let o=0;o<r.length;o++){let a=r[o];e=e.update({filterFrom:a.from,filterTo:a.to,filter:()=>!1})}e=e.update({add:n})}return e}omitInline(e){let t=this._settings.hlTagDisplayBehaviour&0,n=this._settings.spanTagDisplayBehaviour&0,r=this._settings.hlTagDisplayBehaviour&1,o=this._settings.spanTagDisplayBehaviour&1,a=[];for(let s=0;s<e.length;s++){let l=e[s],u=l.from,c=u+l.openLen,h=c+l.tagLen;this._selectionObserver.touchSelection(l.from,l.to)?l.validTag&&!this._selectionObserver.touchSelection(c,h)&&(l.type==5&&r||l.type==6&&o)&&a.push(ke.of(c,h,l)):((l.type==5&&!t||l.type==6&&!n)&&(c=h),a.push(ke.of(u,c,l)),l.closeLen&&a.push(ke.of(l.to-l.closeLen,l.to,l)))}return oe.Decoration.set(a,!0)}},Pn=class{constructor(e){d(this,"parser");d(this,"lineBreakSet",N.RangeSet.empty);this.parser=e}replace(e,t){var a,s;let n=this.parser.reparsedRanges[0],r=this.parser.blockTokens,o={add:this._produceWidgetRanges(e)};return r.length?((n.from!=n.initTo||n.from!=n.changedTo)&&(o.filterFrom=Math.min((s=(a=r[n.from])==null?void 0:a.from)!=null?s:this.parser.lastStreamPoint.from,this.parser.lastStreamPoint.from),o.filterTo=this.parser.lastStreamPoint.to,o.filter=()=>!1),t&&(this.lineBreakSet=this.lineBreakSet.map(t)),this.lineBreakSet=this.lineBreakSet.update(o)):this.lineBreakSet=N.RangeSet.empty}_getReparsedBlockTokens(){let e=this.parser.reparsedRanges[0];return this.parser.blockTokens.slice(e.from,e.changedTo)}_produceWidgetRanges(e){let t=this._getReparsedBlockTokens(),n=[];if(!t.length)return n;let r=0,o=Fe.atOffset(e,t[0].from);do{let a=t[r],{curLine:s}=o;if(!a)break;if(a.status!=1){r++;continue}if(!(s.from==a.from||s.from-1==a.from+a.openLen+a.tagLen)){if(s.from>=a.to||s.to<a.from||s.to==a.to&&a.closedByBlankLine){r++;continue}n.push(Ft.of(s.from))}}while(o.next());return n}},Nn=class{constructor(){d(this,"activeTokens",[]);d(this,"hlTokens",[]);d(this,"spoilerTokens",[])}catch(e,t,n){this.activeTokens=e,this.hlTokens=t,this.spoilerTokens=n}empty(){this.activeTokens=[],this.hlTokens=[],this.spoilerTokens=[]}},Gt=class{constructor(e,t){d(this,"_parser");d(this,"_omitter");d(this,"_catcher");d(this,"_lineBreakReplacer");d(this,"_selectionObserver");d(this,"_settings");d(this,"holder");this._parser=e,this._selectionObserver=t,this._settings=e.settings,this._omitter=new On(this._settings,t),this._catcher=new Nn,this._lineBreakReplacer=new Pn(e),this.holder=new Rn}buildMain(e,t,n){var a,s,l,u;let{visibleRanges:r}=e,o=t.sliceDoc((s=(a=r[0])==null?void 0:a.from)!=null?s:0,(u=(l=r[r.length-1])==null?void 0:l.to)!=null?u:0);r.length||(r=[{from:0,to:0}]),this._buildInline(r,o),this._buildBlock(r,o,n)}buildSupplementary(e){e?(this._omitInlineDelim(this._catcher.activeTokens),this._createColorBtnWidgets(this._catcher.hlTokens),this._revealSpoiler(this._catcher.spoilerTokens)):this.holder.colorBtnSet=this.holder.revealedSpoilerSet=N.RangeSet.empty}onViewInit(e){let t=e.state,n=t.field(at.editorLivePreviewField),r=!n&&this._settings.noStyledDivInSourceMode;this.buildMain(e,t,r),this.buildSupplementary(n)}onViewUpdate(e,t){let n=e.state,r=e.view,o=n.field(at.editorLivePreviewField),a=!o&&this._settings.noStyledDivInSourceMode;(t.isParsing||t.isRefreshed||t.isModeChanged&&this._settings.noStyledDivInSourceMode||e.viewportMoved)&&this.buildMain(r,n,a),(t.isObserving||t.isRefreshed||e.viewportMoved)&&this.buildSupplementary(o),t.isParsing=t.isObserving=t.isRefreshed=t.isModeChanged=!1}onStateInit(e){e.field(at.editorLivePreviewField)&&this._omitFencedDivOpening(),this._replaceLineBreaks(e.doc)}onStateUpdate(e,t){t.isParsing&&this._replaceLineBreaks(e.newDoc,e.changes),(t.isModeChanged||t.isDeepRefreshed)&&(this.holder.blockOmittedSet=N.RangeSet.empty),e.state.field(at.editorLivePreviewField)?(t.isObserving||t.isModeChanged)&&this._omitFencedDivOpening(e.changes):this._removeOmitter()}_buildInline(e,t){let n=[],r=[],o=[],a=[],s=e[0].from;return yn({tokens:this._parser.inlineTokens,ranges:e,callback:l=>{if(l.status!=1)return;l.type==5&&o.push(l),l.type==2&&a.push(l),r.push(l);let u="cm-"+C[l.type].class;if(l.tagLen){let c=Rt(l),h=t.slice(c.from-s+1,c.to-s-1);l.type==6?(h=pn(h),u+=" "+h):u+=" "+u+"-"+h}n.push(Kr(l,u))}}),this._catcher.catch(r,o,a),this.holder.inlineSet=oe.Decoration.set(n)}_buildBlock(e,t,n){let r=[],o=e[0].from;return yn({tokens:this._parser.blockTokens,ranges:e,callback:a=>{if(a.status!=1)return;let s="cm-"+ne[a.type].class,{contentRange:l,tagRange:u}=$(a),c=pn(t.slice(u.from-o,u.to-o)),h=s+" cm-fenced-div-start",p=s+(n?"":" "+c),m=!!t.slice(l.from-o,l.to-o).trimEnd();r.push(oe.Decoration.line({class:h,token:a}).range(a.from)),m&&r.push(oe.Decoration.line({class:p,token:a}).range(l.from+1))}}),this.holder.blockSet=oe.Decoration.set(r)}_createColorBtnWidgets(e){if(!this._settings.colorButton)return this.holder.colorBtnSet=N.RangeSet.empty;let t=[];for(let n=0;n<e.length;n++){let r=e[n];this._selectionObserver.touchSelection(r.from,r.to)&&t.push(Ht.of(r))}return this.holder.colorBtnSet=oe.Decoration.set(t)}_revealSpoiler(e){let t=[];for(let n=0;n<e.length;n++){let r=e[n];this._selectionObserver.touchSelection(r.from,r.to)&&t.push(Fi.range(r.from,r.to))}return this.holder.revealedSpoilerSet=oe.Decoration.set(t)}_omitInlineDelim(e){return this.holder.inlineOmittedSet=this._omitter.omitInline(e)}_replaceLineBreaks(e,t){return this.holder.lineBreaksSet=this._lineBreakReplacer.replace(e,t)}_omitFencedDivOpening(e){return this._settings.alwaysShowFencedDivTag&2?this.holder.blockOmittedSet=N.RangeSet.empty:this.holder.blockOmittedSet=this._omitter.omitBlock(this.holder.blockOmittedSet,e)}_removeOmitter(){this.holder.inlineOmittedSet=this.holder.blockOmittedSet=N.RangeSet.empty}};var st=require("@codemirror/state");var Mn=require("@codemirror/state");function jr(i,e){let t=e.sliceString(i.from,i.to),n=t.length-t.trimStart().length,r=t.length-t.trimEnd().length;return t.length==n?Mn.EditorSelection.cursor(i.from):Mn.EditorSelection.range(i.from+n,i.to-r)}function Gi(i,e){for(let t=0;t<i.ranges.length;t++){let n=jr(i.ranges[t],e);i=i.replaceRange(n,t)}return i}function Bi(i,e){return i.startsWith(e)&&i.endsWith(e)}var An=class{constructor(e,t,n,r,o){d(this,"editorState");d(this,"doc");d(this,"tokens");d(this,"selectionRanges");d(this,"curSelectionIndex",0);d(this,"tokenMaps");d(this,"curTokenMap");d(this,"level");d(this,"type");d(this,"delimStr");d(this,"tagStr");d(this,"precise");d(this,"changes",[]);d(this,"selectionShift",{});d(this,"changeSet");d(this,"remappedSelection");if(this.type=e,this.editorState=t,this.doc=t.doc,this.level=He(e)?1:0,this.tagStr=o,this.precise=r.tidyFormatting,this.tokens=n.parser.getTokens(this.level),this.tokenMaps=n.pickMaps(e),this.curTokenMap=this.tokenMaps[this.curSelectionIndex],this.precise){let l=Gi(n.selection,this.doc);this.selectionRanges=l.ranges.map(u=>u)}else this.selectionRanges=n.selection.ranges.map(l=>l);o&&this.level==1?this.tagStr="{"+o+"}":this.level==0&&(this.tagStr+=`
`);let{char:a,length:s}=this.level==1?C[e]:ne[e];this.delimStr=a.padEnd(s,a)}get curRange(){return this.selectionRanges[this.curSelectionIndex]}get mappedTokens(){return this.curTokenMap?this.curTokenMap.map(e=>this.tokens[e]):[]}advance(){return this.curSelectionIndex++,this.curSelectionIndex>=this.selectionRanges.length?!1:(this.curTokenMap=this.tokenMaps[this.curSelectionIndex],!0)}pushChange(e){this.changes.push(e)}pushSelectionShift(e,t){this.selectionShift[e]={shift:t}}},Bt=class{constructor(e,t){d(this,"_parser");d(this,"_observer");d(this,"_settings");d(this,"state");this._parser=e,this._observer=t,this._settings=this._parser.settings}startFormat(e,t,n,r,o){var l;r&&(n=void 0),this._settings.openTagMenuAfterFormat||(o=!1);let a=this._observer.pickMaps(t),s=e.state;if(a.length==1&&!((l=a[0])!=null&&l.length)&&o){Q.create(e,t).showMenu();return}this._defineState(s,t,n),r?this._removeAll():this.state.level==1?this._formatInline():this._formatBlock(),this._composeChanges(),this._remapSelection(),this._dispatchToView(e)}_defineState(e,t,n){this.state=new An(t,e,this._observer,this._settings,n)}_clearState(){this.state=void 0}_formatInline(){let e=this.state,t=this.state.tokens;do{let{curTokenMap:n,curRange:r,tagStr:o,precise:a}=e,s=n?t[n[0]]:null;a?s?s.from>r.from||s.to<r.to?this._extend():s.status!=1?this._close(s):o!==void 0?this._changeInlineTag(s):r.empty?this._remove(s):this._breakApart(s):this._wrap():this._toggleInlineDelim()}while(e.advance())}_formatBlock(){do this._toggleBlockTag();while(this.state.advance())}_wrap(e=!0){var o,a;let{curRange:t,delimStr:n,tagStr:r}=this.state;if(t.empty){let s=t.from;if(e&&(t=(o=this.state.editorState.wordAt(t.from))!=null?o:t),s==t.to){let l=n.length;s==t.from&&(l+=(a=r==null?void 0:r.length)!=null?a:0),this.state.pushSelectionShift(this.state.curSelectionIndex,l)}}this.state.pushChange([{from:t.from,insert:n+(r!=null?r:"")},{from:t.to,insert:n}])}_close(e){let{delimStr:t,tagStr:n}=this.state;kt(e.type)&&n&&this.state.pushChange({from:e.from+e.openLen,insert:n}),this.state.pushChange({from:e.to,insert:t})}_breakApart(e){let{openRange:t,tagRange:n,closeRange:r}=$(e),{curRange:o,delimStr:a}=this.state,s=this.state.doc.sliceString(n.from,n.to);Dn(o.from,t)?this.state.pushChange(t):this.state.pushChange({from:o.from,insert:a}),Dn(o.to,r)?this.state.pushChange(r):this.state.pushChange({from:o.to,insert:a+s})}_extend(){let{curRange:e,delimStr:t,tagStr:n,curTokenMap:r,mappedTokens:o}=this.state,a=this._parser.getTokens(this.state.level),s=r==null?void 0:r[0],l=r==null?void 0:r.at(-1),u=o[0],c=o[o.length-1],h=!1,p={from:s!=null?s:0,to:(l!=null?l:0)+1};if(u&&u.from<=e.from){let{tagRange:m,closeRange:v}=$(u);p.from++,n!==void 0&&this.state.pushChange(u.validTag?{from:m.from,to:m.to,insert:n}:{from:m.from,insert:n}),this.state.pushChange(v)}else this.state.pushChange({from:e.from,insert:t});c&&c.to>=e.to&&(h=!0,p.to--);for(let m=p.from;m<p.to;m++){let v=r==null?void 0:r[m];v!==void 0&&this._remove(a[v])}if(h){let{openRange:m,tagRange:v}=$(c);this.state.pushChange(m),c.validTag&&this.state.pushChange(v),c.status!=1&&this.state.pushChange({from:e.to,insert:t})}else this.state.pushChange({from:e.to,insert:t})}_changeInlineTag(e){let{tagRange:t}=$(e),{tagStr:n,curRange:r,curSelectionIndex:o}=this.state;n!==void 0&&(e.validTag||(t.to=t.from),this.state.pushChange({from:t.from,to:t.to,insert:n}),r.empty&&r.from==t.from&&this.state.pushSelectionShift(o,n.length))}_toggleInlineDelim(){let{curRange:e,delimStr:t}=this.state,n=t.length,r=this.state.doc.sliceString(e.from-n,e.to+n),o=r.slice(n,-n);Bi(o,t)?this.state.pushChange([{from:e.from,to:e.from+n},{from:e.to-n,to:e.to}]):Bi(r,t)?this.state.pushChange([{from:e.from-n,to:e.from},{from:e.to,to:e.to+n}]):this._wrap(!1)}_addBlockTag(e){var s;let{doc:t}=this.state,{delimStr:n}=this.state,r=t.line(e.start),o=t.line(e.end-1),a=(s=this.state.tagStr)!=null?s:"";Pi(t,r)||(n=`
`+n),this.state.pushChange({from:r.from,insert:n+a}),Oi(t,o)||this.state.pushChange({from:o.to,insert:`
`})}_changeBlockTag(e){let{tagRange:t}=$(e),{tagStr:n}=this.state;this.state.pushChange({from:t.from,to:t.to,insert:n})}_toggleBlockTag(){let{doc:e}=this.state,t=Ri(e,this.state.curRange),{mappedTokens:n,tagStr:r}=this.state;for(let o=0,a=0;o<t.length;o++){let s=t[o],l=n[a],u=e.line(s.start),c=l?Rt(l):void 0;!l||u.from<l.from?this._addBlockTag(s):l.status!=1||u.from>c.to+1?(this._addBlockTag(s),a++):r===void 0?(this._remove(l),a++):(this._changeBlockTag(l),a++)}}_remove(e){let{openRange:t,tagRange:n,closeRange:r}=$(e),o=[t,n,r];e.validTag||o.remove(n),e.level==0&&e.to>n.to&&n.to++,this.state.pushChange(o)}_removeAll(){do{let{mappedTokens:e}=this.state;e.forEach(t=>{this._remove(t)})}while(this.state.advance())}_composeChanges(){return this.state.changeSet=st.ChangeSet.of(this.state.changes,this.state.doc.length)}_remapSelection(){var r;let{selectionRanges:e,changeSet:t,selectionShift:n}=this.state;for(let o=0;o<e.length;o++){let a=e[o].map(t),s=(r=n[o])==null?void 0:r.shift;s&&(a=st.EditorSelection.range(a.to+s,a.from+s)),e[o]=a}return this.state.remappedSelection=st.EditorSelection.create(e)}_dispatchToView(e){let{changeSet:t,remappedSelection:n}=this.state;e.dispatch({changes:t},{selection:n,sequential:!0}),this._clearState()}};var Hn=require("@codemirror/language"),Vt=require("@codemirror/state");function Vi(){var t,n;let i=(t=Object.getOwnPropertyDescriptor(Hn.Language,"state"))==null?void 0:t.value,e=(n=Object.getOwnPropertyDescriptor(Hn.Language,"setState"))==null?void 0:n.value;if(!(i instanceof Vt.StateField&&e instanceof Vt.StateEffectType))throw TypeError();return{langStateField:i,langStateFxType:e}}function Xr(i){return!(!i.selection||i.startState.selection.eq(i.selection,!1))}function Yr(i){let e=i.state.field(Fn.editorLivePreviewField),t=i.startState.field(Fn.editorLivePreviewField);return e!=t}function zr(i){let{tree:e,treeLen:t}=i.state.field($r).context;return i.effects.forEach(n=>{n.is(Qr)&&({tree:e,treeLen:t}=n.value.context)}),{tree:e,targetLen:t}}var Gn=class{constructor(e,t,n,r){d(this,"builder");d(this,"mainPlugin");d(this,"root");d(this,"activities");this.mainPlugin=e,this.root=t.root,this.builder=n,this.activities=r,this.builder.onViewInit(t)}update(e){this.root!==e.view.root&&this._onRootChanged(e.view.root),this.builder.onViewUpdate(e,this.activities)}destroy(){this.mainPlugin.tagManager.colorsHandler.eject(this.root),this.mainPlugin.opacityHandler.eject(this.root)}_onRootChanged(e){this.mainPlugin.tagManager.colorsHandler.eject(this.root),this.mainPlugin.opacityHandler.eject(this.root),this.mainPlugin.tagManager.colorsHandler.inject(e),this.mainPlugin.opacityHandler.inject(e),this.root=e}},Bn=de.Annotation.define(),W=de.Facet.define({combine(i){if(!i.length)return;let e=i[0],t=new Ot(e.settings),n=new Nt(t),r=new Gt(t,n),o=new Bt(t,n);return{mainPlugin:e,parser:t,observer:n,builder:r,formatter:o,activities:{}}},get static(){return!0}}),xn=de.Facet.define({combine(i){return i[0]},get static(){return!0}}),{langStateField:$r,langStateFxType:Qr}=Vi(),Ui=i=>{let e=de.StateField.define({create(n){let{parser:r,observer:o,builder:a,activities:s}=n.facet(W);return r.initParse(n.doc,(0,Ut.syntaxTree)(n)),o.observe(n.selection,!0),a.onStateInit(n),{parser:r,observer:o,builder:a,activities:s,lineBreaksSet:a.holder.lineBreaksSet,blockOmittedSet:a.holder.blockOmittedSet}},update(n,r){var x;let{tree:o,targetLen:a}=zr(r),{parser:s,observer:l,builder:u,activities:c}=n,h=(0,Ut.syntaxTreeAvailable)(r.state,a),p=r.annotation(Bn),m=!1,v=!1,E=!!p,O=!!(p!=null&&p.deep),H=Yr(r);return r.docChanged&&s.storeChanges(r.changes),O?(s.initParse(r.newDoc,o),m=!0):(s.hasStoredChanges()||s.lastStop!=a)&&h&&(s.applyChange(r.newDoc,o,a),m=!0),O||H?(l.restartObserver(r.newSelection,r.docChanged),v=!0):(m||Xr(r))&&(l.observe(r.newSelection,(x=c.isParsing)!=null?x:!1),v=!0),u.onStateUpdate(r,{isParsing:m,isObserving:v,isDeepRefreshed:O,isModeChanged:H}),c.isParsing||(c.isParsing=m),c.isObserving||(c.isObserving=v),c.isRefreshed||(c.isRefreshed=E),c.isModeChanged||(c.isModeChanged=H),n.lineBreaksSet===u.holder.lineBreaksSet&&n.blockOmittedSet===u.holder.blockOmittedSet?n:{parser:s,observer:l,builder:u,activities:c,lineBreaksSet:u.holder.lineBreaksSet,blockOmittedSet:u.holder.blockOmittedSet}},provide(n){return[ae.EditorView.decorations.from(n,r=>r.blockOmittedSet),de.Prec.lowest(ae.EditorView.decorations.from(n,r=>r.lineBreaksSet))]}}),t=ae.ViewPlugin.define(n=>{let{builder:r,activities:o}=n.state.facet(W);return new Gn(i,n,r,o)},{provide:()=>[xn.of({colorMenuItem:{number:0},spanTagMenuItem:{number:0},divTagMenuItem:{number:0}}),ae.EditorView.decorations.of(n=>n.state.facet(W).builder.holder.blockSet),ae.EditorView.decorations.of(n=>n.state.facet(W).builder.holder.inlineOmittedSet),ae.EditorView.decorations.of(n=>n.state.facet(W).builder.holder.colorBtnSet),ae.EditorView.decorations.of(n=>n.state.facet(W).builder.holder.revealedSpoilerSet),ae.EditorView.outerDecorations.of(n=>n.state.facet(W).builder.holder.inlineSet)]});return[W.of(i),e,t]};function De(i){return i.state.facet(W).formatter}var Zr={id:"toggle-insertion",name:"Toggle insertion",icon:"underline",ctxMenuTitle:"Insertion",editorCallback:(i,e)=>{let t=i.activeCm||i.cm;t instanceof Z.EditorView&&De(t).startFormat(t,1)},type:1},Jr={id:"toggle-spoiler",name:"Toggle spoiler",icon:"rectangle-horizontal",ctxMenuTitle:"Spoiler",editorCallback:(i,e)=>{let t=i.activeCm||i.cm;t instanceof Z.EditorView&&De(t).startFormat(t,2)},type:2},eo={id:"toggle-superscript",name:"Toggle superscript",icon:"superscript",ctxMenuTitle:"Superscript",editorCallback:(i,e)=>{let t=i.activeCm||i.cm;t instanceof Z.EditorView&&De(t).startFormat(t,3)},type:3},to={id:"toggle-subscript",name:"Toggle subscript",icon:"subscript",ctxMenuTitle:"Subscript",editorCallback:(i,e)=>{let t=i.activeCm||i.cm;t instanceof Z.EditorView&&De(t).startFormat(t,4)},type:4},no={id:"toggle-custom-highlight",name:"Toggle custom highlight",icon:"highlighter",ctxMenuTitle:"Custom highlight",editorCallback:(i,e)=>{let t=i.activeCm||i.cm;t instanceof Z.EditorView&&De(t).startFormat(t,5,void 0,!1,!0)},type:5},io={id:"toggle-custom-span",name:"Toggle custom span",icon:"brush",ctxMenuTitle:"Custom span",editorCallback:(i,e)=>{let t=i.activeCm||i.cm;t instanceof Z.EditorView&&De(t).startFormat(t,6,void 0,!1,!0)},type:6},ro={id:"toggle-fenced-div",name:"Toggle fenced div",icon:"list-plus",editorCallback:(i,e)=>{let t=i.activeCm||i.cm;t instanceof Z.EditorView&&De(t).startFormat(t,7,void 0,!1,!0)}},oo={id:"show-color-menu",name:"Show highlight color menu",icon:"palette",editorCallback:(i,e)=>{let t=i.activeCm||i.cm;t instanceof Z.EditorView&&Q.create(t,5).showMenu()}},ao={id:"show-custom-span-tag-menu",name:"Show custom span tag menu",icon:"shapes",editorCallback:(i,e)=>{let t=i.activeCm||i.cm;t instanceof Z.EditorView&&Q.create(t,6).showMenu()}},so={id:"show-fenced-div-tag-menu",name:"Show fenced div tag menu",icon:"shapes",editorCallback:(i,e)=>{let t=i.activeCm||i.cm;t instanceof Z.EditorView&&Q.create(t,7).showMenu()}},Ln=[Zr,Jr,eo,to,no,io],Wi=[ro,oo,ao,so].concat(Ln);var qi=require("obsidian");var Wt=class{constructor(e){d(this,"_plugin");d(this,"_defaultConfigs",{get 5(){return Le.colorConfigs},get 6(){return Le.predefinedSpanTag},get 7(){return Le.predefinedDivTag}});d(this,"_handlers",{5:{move:[],add:[],remove:[],reset:[]},6:{move:[],add:[],remove:[],reset:[]},7:{move:[],add:[],remove:[],reset:[]}});d(this,"colorsHandler");d(this,"configsMap");d(this,"_requestSave",(0,qi.debounce)(this._save,200));let{settings:t}=e;this._plugin=e,this.configsMap={5:t.colorConfigs,6:t.predefinedSpanTag,7:t.predefinedDivTag},this.colorsHandler=qn(e),this.registerHandler(5,"move",(n,r,o)=>{this.colorsHandler.moveRule(r,o)}),this.registerHandler(5,"add",n=>{let r=Ee(n);this.colorsHandler.insert(r)}),this.registerHandler(5,"remove",(n,r)=>{this.colorsHandler.removeSingle(r)}),this.registerHandler(5,"reset",n=>{this.colorsHandler.removeAll(),n.forEach(r=>{let o=Ee(r);this.colorsHandler.insert(o)})})}reset(e){let t=this._defaultConfigs[e];this.configsMap[e].splice(0),this.configsMap[e].push(...t),this._fireHandlers(e,"reset",this.configsMap[e])}move(e,t,n){if(n==t)return;let r=this.configsMap[e],o=r.splice(t,1)[0];r.splice(n,0,o),this._fireHandlers(e,"move",o,t,n)}remove(e,t){let n=this.configsMap[e];this._fireHandlers(e,"remove",n.splice(t,1)[0],t)}add(e,t){let n=this.configsMap[e],r=n.length+1;if(!t){let o=e==5;t={name:`${o?"Color":"Tag"} ${r}`,tag:`${o?"color":"tag"}-${r}`,showInMenu:!0},o&&(t.color="#ffd000")}n.push(t),this._fireHandlers(e,"add",t,n.length-1)}registerHandler(e,t,n){this._handlers[e][t].push(n)}_fireHandlers(e,t,...n){this._handlers[e][t].forEach(r=>{let o=n[0],a=n[1],s=n[2];r(o,a,s)}),this._requestSave()}_save(){this._plugin.saveSettings()}};function lo(i,e){for(let t of e)if(i.classList.contains(t))return!0;return!1}function Ki(i){return i==" "||i==`
`||i=="	"}var qt=class i{constructor(e,t){d(this,"root");d(this,"_walker");d(this,"_offset",0);d(this,"_curNode");d(this,"_nodeChanged",!1);d(this,"_stack",[]);d(this,"_queue",{});d(this,"_parsingQueue");this.root=e,this._walker=document.createTreeWalker(e,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT),this._walker.nextNode(),this._curNode=this._walker.currentNode,this._parsingQueue=t}streamParse(){do this._curNode instanceof Text?(this._offset=0,this._parseTextNode()):this._curNode instanceof Element&&(this._isSkipped(this._curNode)?(this._resolve(3),this._resolve(4)):this._curNode.textContent&&(this._parsingQueue.push(new i(this._curNode,this._parsingQueue)),/\s/.test(this._curNode.textContent)&&(this._resolve(3),this._resolve(4))));while(this._nextNode());this._forceResolveAll()}_parseTextNode(){var t;let e=(t=this._curNode.textContent)!=null?t:"";for(;!this._nodeChanged&&this._offset<e.length;){let n=e[this._offset],r=ie[n];if(n==" "||n==`
`||n=="	"){this._resolve(3),this._resolve(4),this._offset++;continue}if(!r||r==5){this._offset++;continue}this._tokenize(r)}this._nodeChanged=!1}_finalize(e,t,n,r){let o=C[e].getEl();r.deleteContents(),n.surroundContents(o),t.deleteContents(),o==this._curNode.nextSibling?this._nextNode():this._prevNode(),this._nodeChanged=!0}_resolve(e,t){if(t&&this._queue[e]){let n=new Range,r=this._queue[e];n.setStart(r.endContainer,r.endOffset),n.setEnd(t.startContainer,t.startOffset),this._stack.findLast((o,a)=>{if(delete this._queue[o],o==e)return this._stack.splice(a),!0}),this._finalize(e,r,n,t)}else delete this._queue[e],this._stack=this._stack.filter(n=>n!=e)}_forceResolveAll(){for(let e=0;e<z.ALL_INLINE.length;e++)this._resolve(z.ALL_INLINE[e])}_tokenize(e){let{length:t,char:n}=C[e],r=this._curNode.textContent,o=0,a=!!this._queue[e],s=Ki(r[this._offset-1]),l;for(;r[this._offset]==n;)this._offset++,o++;if(l=Ki(r[this._offset]),a&&s||!a&&l||o!=t)return!1;let u=new Range;return u.setStart(this._curNode,this._offset-o),u.setEnd(this._curNode,this._offset),this._pushDelim(e,u),!0}_pushDelim(e,t){this._queue[e]?this._resolve(e,t):(this._queue[e]=t,this._stack.push(e))}_nextNode(){return this._walker.nextSibling()?(this._curNode=this._walker.currentNode,!0):!1}_prevNode(){return this._walker.previousSibling()?(this._curNode=this._walker.currentNode,!0):!1}_isSkipped(e){return lo(e,wi)||e.tagName=="CODE"||e.tagName=="IMG"}};function Yi(i){return i.trim().replaceAll(/\s{2,}/g," ")}function ji(i){return i instanceof HTMLParagraphElement||i instanceof HTMLHeadingElement}function Xi(i){return i.hasClass("table-cell-wrapper")}function uo(i){return i.hasClass("callout")}function co(i,e){let t=C[6].class;e.querySelectorAll("."+t).forEach(r=>{var a;if(!(r.firstChild instanceof Text&&r.firstChild.textContent))return;let o=(a=Ii.exec(r.firstChild.textContent))==null?void 0:a[1];if(o){let s=Yi(o).split(" ");if(r.classList.add(...s),i.showSpanTagInPreviewMode)return;let l=0,u=l+o.length+2;r.firstChild.replaceData(l,u-l,"")}})}function ho(i,e){let t=e.querySelectorAll("mark"),n=C[5].class;t.forEach(r=>{var a;if(!(r.firstChild instanceof Text&&r.firstChild.textContent))return;let o=(a=yi.exec(r.firstChild.textContent))==null?void 0:a[1];if(o){if(r.classList.add(n,`${n}-${o}`),i.showHlTagInPreviewMode)return;let s=0,l=s+o.length+2;r.firstChild.replaceData(s,l-s,"")}})}function fo(i,e){var a;if(!(e.firstChild instanceof Text&&e.firstChild.textContent))return;hn.lastIndex=0;let t=ne[7].class,n=e.firstChild,r=e.querySelector("br"),o=hn.exec((a=n.textContent)!=null?a:"");if(o){let s=o[1],l=Yi(s).split(" ");if(e.addClass(t,...l),i.alwaysShowFencedDivTag&1)return;e.removeChild(n),r&&e.removeChild(r)}}var Kt=class{constructor(e){d(this,"_SELECTOR_QUERY","p, h1, h2, h3, h4, h5, h6, td, th, li:not(:has(p)), .callout-title-inner");d(this,"_settings");d(this,"postProcess",(e,t)=>{var a,s;let n=e==t.containerEl,r=(s=(a=e.parentElement)==null?void 0:a.hasClass("print"))!=null?s:!1,o=!n||r;if(n){if(!this._settings.decoratePDF)return;let l=e.querySelectorAll(o?"&>div":"&>*");for(let u=0;u<l.length;u++)this._draw(l[u],o)}else this._draw(e,!0)});this._settings=e,this.postProcess.sortOrder=0}_parseInline(e,t=!0){let n=Xi(e)||!t&&ji(e)?[e]:e.querySelectorAll(this._SELECTOR_QUERY),r=[];for(let o=0;o<n.length;o++){new qt(n[o],r).streamParse();for(let a=0;a<r.length;a++)if(r[a].streamParse(),a>=100)throw Error(`${r}`);r.splice(0)}}_isTargeted(e,t=!0){let n=t?e.firstElementChild:e;return!!(Xi(e)||n&&(ji(n)||uo(n)||n instanceof HTMLTableElement||n instanceof HTMLUListElement||n instanceof HTMLOListElement||n.tagName=="BLOCKQUOTE"))}_draw(e,t=!0){if(this._isTargeted(e,t)){if(this._settings.customHighlight&1&&ho(this._settings,e),this._settings.fencedDiv&1){let n=t?e.firstElementChild:e;n instanceof HTMLParagraphElement&&fo(this._settings,n)}this._parseInline(e,t),this._settings.customSpan&1&&co(this._settings,e)}}};var jt=class extends Xt.Plugin{constructor(){super(...arguments);d(this,"settings");d(this,"opacityHandler");d(this,"tagManager")}async onload(){await this.loadSettings(),this.addSettingTab(new It(this.app,this)),fn(this.settings),this.registerEditorExtension(Ui(this)),this.registerMarkdownPostProcessor(new Kt(this.settings).postProcess),this.tagManager=new Wt(this),this.opacityHandler=new xe(this),this.opacityHandler.insert(`body.theme-light{--hl-opacity:${this.settings.lightModeHlOpacity}}`),this.opacityHandler.insert(`body.theme-dark{--hl-opacity:${this.settings.darkModeHlOpacity}}`),this.registerCommands(Wi),this.extendEditorCtxMenu(),console.log("Load Extended Markdown Syntax")}async loadSettings(){this.settings=Object.assign({},structuredClone(Le),await this.loadData())}async saveSettings(){await this.saveData(this.settings)}onunload(){this.tagManager.colorsHandler.destroy(),this.opacityHandler.destroy(),console.log("Unload Extended Markdown Syntax")}reconfigureDelimLookup(){fn(this.settings)}refreshMarkdownView(t=!0){this.app.workspace.getLeavesOfType("markdown").forEach(n=>{n.view instanceof Xt.MarkdownView&&(n.view.editor.cm.dispatch({annotations:Bn.of({deep:t})}),n.view.previewMode.rerender(!0))})}setHlOpacity(t,n){let r=n==0?"body.theme-light":"body.theme-dark",o="--hl-opacity",a=n;this.opacityHandler.replace(`${r}{${o}:${t}}`,a)}registerCommands(t){t.forEach(n=>this.addCommand(n))}extendEditorCtxMenu(){this.registerEvent(this.app.workspace.on("editor-menu",(t,n,r)=>{Ai(t,n,r)}))}};
/*! Bundled license information:

sortablejs/modular/sortable.esm.js:
  (**!
   * Sortable 1.15.6
   * @author	RubaXa   <trash@rubaxa.org>
   * @author	owenm    <owen23355@gmail.com>
   * @license MIT
   *)
*/

/* nosourcemap */